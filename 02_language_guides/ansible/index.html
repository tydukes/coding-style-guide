
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Configuration management standards for Ansible playbooks and roles">
      
      
        <meta name="author" content="Tyler Dukes">
      
      
        <link rel="canonical" href="https://tydukes.github.io/coding-style-guide/02_language_guides/ansible/">
      
      
        <link rel="prev" href="../crossplane/">
      
      
        <link rel="next" href="../python/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Ansible Style Guide - The Dukes Engineering Style Guide</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/print.css">
    
      <link rel="stylesheet" href="../../stylesheets/toc.css">
    
      <link rel="stylesheet" href="../../stylesheets/features.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-XXXXXXXXXX",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#language-overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="The Dukes Engineering Style Guide" class="md-header__button md-logo" aria-label="The Dukes Engineering Style Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The Dukes Engineering Style Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Ansible Style Guide
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/tydukes/coding-style-guide" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    coding-style-guide
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../01_overview/getting_started/" class="md-tabs__link">
          
  
  
  Overview

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../00_standards/heading_structure/" class="md-tabs__link">
          
  
  
  Standards

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../comparison_matrix/" class="md-tabs__link">
          
  
  
  Language Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../03_metadata_schema/schema_reference/" class="md-tabs__link">
        
  
  
    
  
  Metadata Schema

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../04_templates/README_template/" class="md-tabs__link">
          
  
  
  Templates

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../05_examples/python_package_example/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../09_refactoring/" class="md-tabs__link">
          
  
  
  Refactoring

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../08_anti_patterns/" class="md-tabs__link">
          
  
  
  Anti-Patterns

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../10_migration_guides/from_pep8/" class="md-tabs__link">
          
  
  
  Migration Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../11_cloud_providers/azure/" class="md-tabs__link">
          
  
  
  Cloud Providers

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../05_ci_cd/ai_validation_pipeline/" class="md-tabs__link">
          
  
  
  CI / CD

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../06_container/usage/" class="md-tabs__link">
        
  
  
    
  
  Container Usage

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../07_integration/integration_prompt/" class="md-tabs__link">
          
  
  
  Integration

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../12_tutorials/" class="md-tabs__link">
          
  
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../faq/" class="md-tabs__link">
        
  
  
    
  
  FAQ

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../topic_index/" class="md-tabs__link">
        
  
  
    
  
  Topic Index

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../glossary/" class="md-tabs__link">
        
  
  
    
  
  Glossary

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../changelog/" class="md-tabs__link">
        
  
  
    
  
  Changelog

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="The Dukes Engineering Style Guide" class="md-nav__button md-logo" aria-label="The Dukes Engineering Style Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    The Dukes Engineering Style Guide
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/tydukes/coding-style-guide" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    coding-style-guide
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Overview
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_overview/getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_overview/principles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Principles
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_overview/governance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Governance
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_overview/structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Structure
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_overview/decision_trees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Decision Trees
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_overview/maturity_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Maturity Model
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project_status/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Project Status
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Standards
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Standards
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00_standards/heading_structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Heading Structure
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00_standards/code_block_language_tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Block Language Tags
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Language Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Language Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../comparison_matrix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Comparison Matrix
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Infrastructure as Code
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Infrastructure as Code
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../terraform/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Terraform & Terragrunt
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../terragrunt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Terragrunt (live)
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hcl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HCL
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloudformation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AWS CloudFormation
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bicep/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Azure Bicep
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cdk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AWS CDK
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pulumi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pulumi
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes & Helm
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gitops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GitOps (ArgoCD & Flux)
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../crossplane/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Crossplane
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Configuration Management
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Configuration Management
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Ansible
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Ansible
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#language-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Language Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Language Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-characteristics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Characteristics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary-use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Primary Use Cases
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quick Reference
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#collections-first-approach" class="md-nav__link">
    <span class="md-ellipsis">
      
        Collections-First Approach
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Collections-First Approach">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#collection-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Collection Structure
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playbook-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Playbook Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Playbook Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-playbook" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Playbook
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-play-playbook" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Play Playbook
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inventory-organization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inventory Organization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inventory Organization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#static-inventory-ini-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        Static Inventory (INI format)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-inventory-yaml-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        Static Inventory (YAML format)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Group Variables
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variable-precedence" class="md-nav__link">
    <span class="md-ellipsis">
      
        Variable Precedence
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#role-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Role Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Role Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modern-role-with-collection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modern Role with Collection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Role Example
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handlers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handlers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jinja2-templates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Jinja2 Templates
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Jinja2 Templates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jinja2-filters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Jinja2 Filters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ansible-vault" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ansible Vault
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ansible Vault">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-vault-in-playbooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Vault in Playbooks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tags-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tags Strategy
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Handling
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-with-molecule" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing with Molecule
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing with Molecule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molecule-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Molecule Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molecule-verify" class="md-nav__link">
    <span class="md-ellipsis">
      
        Molecule Verify
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role-testing-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Role Testing Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Role Testing Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-write-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Write Tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-to-test" class="md-nav__link">
    <span class="md-ellipsis">
      
        What to Test
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tiered-testing-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tiered Testing Strategy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tiered Testing Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tier-1-static-analysis-30-seconds" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tier 1: Static Analysis (&lt; 30 seconds)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tier-2-role-execution-tests-5-minutes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tier 2: Role Execution Tests (&lt; 5 minutes)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tier-3-compliance-verification-15-minutes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tier 3: Compliance Verification (&lt; 15 minutes)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role-contracts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Role Contracts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idempotency-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Idempotency Verification
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Idempotency Verification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-idempotency-with-molecule" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Idempotency with Molecule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-idempotency-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Idempotency Issues
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-platform-testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Platform Testing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multi-Platform Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#platform-specific-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Platform-Specific Tasks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cicd-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        CI/CD Integration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CI/CD Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#github-actions-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        GitHub Actions Pipeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gitlab-ci-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        GitLab CI Pipeline
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-coverage-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test Coverage Requirements
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test Coverage Requirements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#coverage-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Coverage Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#measuring-coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Measuring Coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role-readme-testing-section" class="md-nav__link">
    <span class="md-ellipsis">
      
        Role README Testing Section
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-pitfalls" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Pitfalls
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Pitfalls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variable-precedence-confusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Variable Precedence Confusion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handler-notification-timing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handler Notification Timing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changed-when-detection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Changed When Detection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loop-variable-shadowing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Loop Variable Shadowing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#template-rendering-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Template Rendering Errors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact-gathering-performance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fact Gathering Performance
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anti-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Anti-Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Anti-Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#avoid-shellcommand-for-everything" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Avoid: Shell/Command for Everything
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-hardcoded-values" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Avoid: Hardcoded Values
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-no-idempotency" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Avoid: No Idempotency
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-ignoring-return-codes" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Avoid: Ignoring Return Codes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-not-using-roles" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Avoid: Not Using Roles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-using-loop-with-package-module" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Avoid: Using Loop with Package Module
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-no-proper-secret-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Avoid: No Proper Secret Management
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ansible-vault-for-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ansible Vault for Secrets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privilege-escalation-security" class="md-nav__link">
    <span class="md-ellipsis">
      
        Privilege Escalation Security
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safe-command-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Safe Command Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-key-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH Key Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secure-file-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Secure File Permissions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inventory-security" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inventory Security
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secure-downloads-and-package-installation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Secure Downloads and Package Installation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#audit-logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Audit Logging
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-log-for-sensitive-output" class="md-nav__link">
    <span class="md-ellipsis">
      
        No Log for Sensitive Output
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tool-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tool Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tool Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ansiblecfg" class="md-nav__link">
    <span class="md-ellipsis">
      
        ansible.cfg
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ansible-lint-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        ansible-lint Configuration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#always-use-fully-qualified-collection-names-fqcn" class="md-nav__link">
    <span class="md-ellipsis">
      
        Always Use Fully Qualified Collection Names (FQCN)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#always-name-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Always Name Tasks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ensure-idempotency" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ensure Idempotency
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-variables-instead-of-hardcoding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Variables Instead of Hardcoding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#organize-with-roles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Organize with Roles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-tags-for-flexibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Tags for Flexibility
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-proper-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implement Proper Error Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-ansible-vault-for-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Ansible Vault for Secrets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-fact-gathering-when-not-needed" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disable Fact Gathering When Not Needed
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-check-mode-for-dry-runs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Check Mode for Dry Runs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#version-pin-collections" class="md-nav__link">
    <span class="md-ellipsis">
      
        Version Pin Collections
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#document-playbooks-and-roles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Document Playbooks and Roles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-handlers-correctly" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Handlers Correctly
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validate-templates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Validate Templates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-assertions-for-prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Assertions for Prerequisites
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-delegation-appropriately" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Delegation Appropriately
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimize-with-async-and-polling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimize with Async and Polling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-includes-and-imports-strategically" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Includes and Imports Strategically
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      
        References
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#official-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Official Documentation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tools
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#community-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Community Resources
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Programming Languages
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Programming Languages
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../go/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Go
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../typescript/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    TypeScript
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bash/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bash
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../powershell/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PowerShell
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SQL
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../repl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    REPL & Interactive Shells
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shell_aliases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Shell Aliases & Functions
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    CI/CD & Automation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    CI/CD & Automation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jenkins_groovy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Jenkins / Groovy
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jenkins_shared_libraries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Jenkins Shared Libraries
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../github_actions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GitHub Actions
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gitlab_ci/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GitLab CI/CD
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Compliance as Code
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Compliance as Code
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compliance_as_code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    InSpec, OPA & Sentinel
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Data Formats
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Data Formats
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../yaml/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    YAML
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../json/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JSON
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../json_schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JSON Schema
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../toml_ini/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    TOML & INI
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" >
        
          
          <label class="md-nav__link" for="__nav_4_8" id="__nav_4_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Containerization
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Containerization
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dockerfile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dockerfile
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../docker_compose/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker Compose
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devcontainer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dev Containers
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_9" >
        
          
          <label class="md-nav__link" for="__nav_4_9" id="__nav_4_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Build Tools
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Build Tools
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../makefile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Makefile
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../task_runners/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task & Just
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_10" >
        
          
          <label class="md-nav__link" for="__nav_4_10" id="__nav_4_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Diagram as Code
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Diagram as Code
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../diagram_as_code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Diagram as Code
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_11" >
        
          
          <label class="md-nav__link" for="__nav_4_11" id="__nav_4_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cross-Language
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cross-Language
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../interoperability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Interoperability
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03_metadata_schema/schema_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Metadata Schema
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Templates
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Templates
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_templates/README_template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    README Template
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_templates/terraform_module_template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Terraform Module
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_templates/python_package_template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python Package
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_templates/gitignore_templates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    .gitignore Templates
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_templates/precommit_config_template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pre-commit Config
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_templates/github_actions_workflow_templates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GitHub Actions Workflows
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_templates/dockerfile_template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dockerfile
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_templates/docker_compose_template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker Compose
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_templates/helm_chart_template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Helm Chart
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_templates/contract_template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CONTRACT.md Template
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_templates/testing_docs_template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Documentation
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_templates/ide_settings_template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IDE Settings
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_templates/debug_config_template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debug Configurations
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_templates/operational_templates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Operational Templates
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_templates/adr_template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR Template
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_templates/reusable_workflows_template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reusable Workflows
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_templates/code_generators_template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Generators
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_examples/python_package_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python Package
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_examples/flask_api_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python Flask API
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_examples/terraform_module_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Terraform Module
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_examples/ansible_role_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ansible Role
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_examples/typescript_library_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    TypeScript Library
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_examples/react_app_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    TypeScript React App
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_examples/monorepo_fullstack_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monorepo Full-Stack
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_examples/mkdocs_site_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MkDocs Documentation Site
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_examples/github_actions_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GitHub Actions Workflows
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Refactoring
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Refactoring
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../09_refactoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../09_refactoring/python_refactoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python Examples
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../09_refactoring/typescript_refactoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    TypeScript Examples
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../09_refactoring/terraform_refactoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Terraform Examples
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../09_refactoring/ansible_refactoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ansible Examples
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../09_refactoring/bash_refactoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bash Examples
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Anti-Patterns
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Anti-Patterns
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../08_anti_patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Common Anti-Patterns
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../08_anti_patterns/code_smell_catalog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Smell Catalog
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../08_anti_patterns/azure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Azure Anti-Patterns
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Migration Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Migration Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../10_migration_guides/from_pep8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    From PEP 8
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../10_migration_guides/from_google/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    From Google Style Guide
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../10_migration_guides/from_airbnb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    From Airbnb Style Guide
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cloud Providers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cloud Providers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../11_cloud_providers/azure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Microsoft Azure
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../11_cloud_providers/gcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Google Cloud Platform
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    CI / CD
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    CI / CD
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_1" >
        
          
          <label class="md-nav__link" for="__nav_12_1" id="__nav_12_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Platform Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Platform Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/ai_validation_pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Validation Pipeline
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/github_actions_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GitHub Actions Guide
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/gitlab_ci_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GitLab CI Guide
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/jenkins_pipeline_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Jenkins Pipeline Guide
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/local_validation_setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Local Validation Setup
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_2" >
        
          
          <label class="md-nav__link" for="__nav_12_2" id="__nav_12_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Testing & Quality
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Testing & Quality
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/testing_strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Strategies
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/iac_testing_standards/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IaC Testing Standards
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/smoke_test_standards/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Smoke Test Standards
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/performance_testing_standards/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Performance Testing
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/chaos_engineering_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chaos Engineering
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/security_scanning_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security Scanning Guide
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/code_signing_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Signing Guide
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_3" >
        
          
          <label class="md-nav__link" for="__nav_12_3" id="__nav_12_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Developer Experience
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Developer Experience
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/precommit_hooks_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pre-commit Hooks Guide
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/git_hooks_library/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Git Hooks Library
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/ide_integration_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IDE Integration Guide
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_4" >
        
          
          <label class="md-nav__link" for="__nav_12_4" id="__nav_12_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Dependency Management
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Dependency Management
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/dependency_update_policies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dependency Update Policies
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/dependabot_auto_merge/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dependabot Auto-Merge
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_5" >
        
          
          <label class="md-nav__link" for="__nav_12_5" id="__nav_12_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Operations
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Operations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/observability_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Observability Guide
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/environment_configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Environment Configuration
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/seed_data_management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Seed Data Management
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/performance_optimization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Performance Optimization
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/documentation_versioning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Documentation Versioning
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_ci_cd/changelog_automation_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog Automation
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../06_container/usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Container Usage
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Integration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    Integration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../07_integration/integration_prompt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Integration Guide
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../07_integration/ai_code_review/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Code Review
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../07_integration/cli_tool/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Tool
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../12_tutorials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../12_tutorials/python_project/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1: Zero to Validated Python Project
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../12_tutorials/terraform_migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2: Migrating Existing Terraform Module
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../12_tutorials/fullstack_app/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3: Full-Stack App with Multiple Languages
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../12_tutorials/team_onboarding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4: Team Onboarding
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../12_tutorials/manual_to_automated/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5: From Manual to Automated
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAQ
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topic_index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Topic Index
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Glossary
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#language-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Language Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Language Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-characteristics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Characteristics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary-use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Primary Use Cases
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quick Reference
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#collections-first-approach" class="md-nav__link">
    <span class="md-ellipsis">
      
        Collections-First Approach
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Collections-First Approach">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#collection-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Collection Structure
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playbook-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Playbook Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Playbook Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-playbook" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Playbook
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-play-playbook" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Play Playbook
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inventory-organization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inventory Organization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inventory Organization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#static-inventory-ini-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        Static Inventory (INI format)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-inventory-yaml-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        Static Inventory (YAML format)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Group Variables
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variable-precedence" class="md-nav__link">
    <span class="md-ellipsis">
      
        Variable Precedence
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#role-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Role Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Role Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modern-role-with-collection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modern Role with Collection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Role Example
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handlers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handlers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jinja2-templates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Jinja2 Templates
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Jinja2 Templates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jinja2-filters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Jinja2 Filters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ansible-vault" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ansible Vault
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ansible Vault">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-vault-in-playbooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Vault in Playbooks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tags-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tags Strategy
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Handling
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-with-molecule" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing with Molecule
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing with Molecule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#molecule-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Molecule Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#molecule-verify" class="md-nav__link">
    <span class="md-ellipsis">
      
        Molecule Verify
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role-testing-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Role Testing Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Role Testing Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-write-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Write Tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-to-test" class="md-nav__link">
    <span class="md-ellipsis">
      
        What to Test
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tiered-testing-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tiered Testing Strategy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tiered Testing Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tier-1-static-analysis-30-seconds" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tier 1: Static Analysis (&lt; 30 seconds)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tier-2-role-execution-tests-5-minutes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tier 2: Role Execution Tests (&lt; 5 minutes)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tier-3-compliance-verification-15-minutes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tier 3: Compliance Verification (&lt; 15 minutes)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role-contracts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Role Contracts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idempotency-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Idempotency Verification
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Idempotency Verification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-idempotency-with-molecule" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Idempotency with Molecule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-idempotency-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Idempotency Issues
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-platform-testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Platform Testing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multi-Platform Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#platform-specific-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Platform-Specific Tasks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cicd-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        CI/CD Integration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CI/CD Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#github-actions-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        GitHub Actions Pipeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gitlab-ci-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        GitLab CI Pipeline
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-coverage-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test Coverage Requirements
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test Coverage Requirements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#coverage-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Coverage Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#measuring-coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Measuring Coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role-readme-testing-section" class="md-nav__link">
    <span class="md-ellipsis">
      
        Role README Testing Section
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-pitfalls" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Pitfalls
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Pitfalls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variable-precedence-confusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Variable Precedence Confusion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handler-notification-timing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handler Notification Timing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changed-when-detection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Changed When Detection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loop-variable-shadowing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Loop Variable Shadowing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#template-rendering-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Template Rendering Errors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact-gathering-performance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fact Gathering Performance
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anti-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Anti-Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Anti-Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#avoid-shellcommand-for-everything" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Avoid: Shell/Command for Everything
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-hardcoded-values" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Avoid: Hardcoded Values
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-no-idempotency" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Avoid: No Idempotency
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-ignoring-return-codes" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Avoid: Ignoring Return Codes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-not-using-roles" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Avoid: Not Using Roles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-using-loop-with-package-module" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Avoid: Using Loop with Package Module
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-no-proper-secret-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Avoid: No Proper Secret Management
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ansible-vault-for-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ansible Vault for Secrets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privilege-escalation-security" class="md-nav__link">
    <span class="md-ellipsis">
      
        Privilege Escalation Security
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safe-command-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Safe Command Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-key-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH Key Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secure-file-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Secure File Permissions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inventory-security" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inventory Security
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secure-downloads-and-package-installation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Secure Downloads and Package Installation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#audit-logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Audit Logging
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-log-for-sensitive-output" class="md-nav__link">
    <span class="md-ellipsis">
      
        No Log for Sensitive Output
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tool-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tool Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tool Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ansiblecfg" class="md-nav__link">
    <span class="md-ellipsis">
      
        ansible.cfg
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ansible-lint-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        ansible-lint Configuration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#always-use-fully-qualified-collection-names-fqcn" class="md-nav__link">
    <span class="md-ellipsis">
      
        Always Use Fully Qualified Collection Names (FQCN)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#always-name-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Always Name Tasks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ensure-idempotency" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ensure Idempotency
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-variables-instead-of-hardcoding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Variables Instead of Hardcoding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#organize-with-roles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Organize with Roles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-tags-for-flexibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Tags for Flexibility
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-proper-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implement Proper Error Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-ansible-vault-for-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Ansible Vault for Secrets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-fact-gathering-when-not-needed" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disable Fact Gathering When Not Needed
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-check-mode-for-dry-runs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Check Mode for Dry Runs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#version-pin-collections" class="md-nav__link">
    <span class="md-ellipsis">
      
        Version Pin Collections
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#document-playbooks-and-roles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Document Playbooks and Roles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-handlers-correctly" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Handlers Correctly
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validate-templates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Validate Templates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-assertions-for-prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Assertions for Prerequisites
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-delegation-appropriately" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Delegation Appropriately
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimize-with-async-and-polling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimize with Async and Polling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-includes-and-imports-strategically" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Includes and Imports Strategically
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      
        References
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#official-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Official Documentation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tools
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#community-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Community Resources
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Ansible</h1>

<h2 id="language-overview">Language Overview<a class="headerlink" href="#language-overview" title="Permanent link">&para;</a></h2>
<p><strong>Ansible</strong> is an agentless configuration management and automation platform that uses YAML-based
playbooks to define infrastructure as code. Modern Ansible development emphasizes collections
over standalone roles.</p>
<h3 id="key-characteristics">Key Characteristics<a class="headerlink" href="#key-characteristics" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Paradigm</strong>: Declarative configuration management</li>
<li><strong>Language</strong>: YAML with Jinja2 templating</li>
<li><strong>Architecture</strong>: Agentless (SSH/WinRM)</li>
<li><strong>Version Support</strong>: Ansible 2.15.x through 2.17.x</li>
<li><strong>Modern Approach</strong>: Collections-first (not standalone roles)</li>
</ul>
<h3 id="primary-use-cases">Primary Use Cases<a class="headerlink" href="#primary-use-cases" title="Permanent link">&para;</a></h3>
<ul>
<li>Configuration management</li>
<li>Application deployment</li>
<li>Infrastructure provisioning</li>
<li>Security and compliance automation</li>
<li>Orchestration and workflow automation</li>
</ul>
<hr />
<h2 id="quick-reference">Quick Reference<a class="headerlink" href="#quick-reference" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th><strong>Category</strong></th>
<th><strong>Convention</strong></th>
<th><strong>Example</strong></th>
<th><strong>Notes</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Naming</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Playbooks</td>
<td><code>kebab-case.yml</code></td>
<td><code>deploy-app.yml</code>, <code>configure-server.yml</code></td>
<td>Descriptive, lowercase</td>
</tr>
<tr>
<td>Roles</td>
<td><code>snake_case</code></td>
<td><code>web_server</code>, <code>database_setup</code></td>
<td>Lowercase with underscores</td>
</tr>
<tr>
<td>Variables</td>
<td><code>snake_case</code></td>
<td><code>app_port</code>, <code>db_host</code></td>
<td>Descriptive variable names</td>
</tr>
<tr>
<td>Collections</td>
<td><code>namespace.collection</code></td>
<td><code>community.general</code>, <code>ansible.builtin</code></td>
<td>Namespace required</td>
</tr>
<tr>
<td><strong>Structure</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Collections</td>
<td>Use collections</td>
<td><code>community.general.docker_container</code></td>
<td>Modern approach</td>
</tr>
<tr>
<td>Playbook</td>
<td>YAML list of plays</td>
<td><code>- name: Configure servers</code></td>
<td>List of plays</td>
</tr>
<tr>
<td>Tasks</td>
<td>YAML task list</td>
<td><code>- name: Install package</code></td>
<td>Descriptive task names</td>
</tr>
<tr>
<td><strong>Files</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Playbook</td>
<td><code>playbook-name.yml</code></td>
<td><code>site.yml</code>, <code>deploy.yml</code></td>
<td>Main playbooks</td>
</tr>
<tr>
<td>Inventory</td>
<td><code>inventory.yml</code> or <code>hosts</code></td>
<td><code>inventory/production.yml</code></td>
<td>Host definitions</td>
</tr>
<tr>
<td>Variables</td>
<td><code>group_vars/</code>, <code>host_vars/</code></td>
<td><code>group_vars/webservers.yml</code></td>
<td>Variable organization</td>
</tr>
<tr>
<td>Roles Dir</td>
<td><code>roles/role_name/</code></td>
<td><code>roles/web_server/tasks/main.yml</code></td>
<td>Standard role structure</td>
</tr>
<tr>
<td><strong>Best Practices</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Idempotency</td>
<td>Always idempotent</td>
<td>Use <code>state: present</code></td>
<td>Tasks can run multiple times</td>
</tr>
<tr>
<td>Task Names</td>
<td>Always name tasks</td>
<td><code>name: Install Nginx</code></td>
<td>Clear, descriptive names</td>
</tr>
<tr>
<td>Collections</td>
<td>Fully qualified</td>
<td><code>ansible.builtin.copy</code></td>
<td>Use FQCN (Fully Qualified Collection Name)</td>
</tr>
<tr>
<td>Variables</td>
<td>Prefix role vars</td>
<td><code>rolename_variable</code></td>
<td>Avoid collisions</td>
</tr>
<tr>
<td><strong>Syntax</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Module Args</td>
<td>YAML dict</td>
<td><code>state: present\n  name: nginx</code></td>
<td>Key-value pairs</td>
</tr>
<tr>
<td>When</td>
<td>Conditional</td>
<td><code>when: ansible_os_family == "Debian"</code></td>
<td>Jinja2 conditions</td>
</tr>
<tr>
<td>Loop</td>
<td><code>loop</code> keyword</td>
<td><code>loop: "{{ users }}"</code></td>
<td>Iterate over items</td>
</tr>
<tr>
<td>Handlers</td>
<td>Notify handlers</td>
<td><code>notify: Restart nginx</code></td>
<td>Triggered on changes</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="collections-first-approach">Collections-First Approach<a class="headerlink" href="#collections-first-approach" title="Permanent link">&para;</a></h2>
<p><strong>Use Ansible Collections</strong> instead of standalone roles:</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Good - Using collection</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure web servers</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install nginx</span>
<span class="w">      </span><span class="nt">ansible.builtin.package</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy website</span>
<span class="w">      </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">index.html.j2</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/www/html/index.html</span>

<span class="c1">## Install collections from Ansible Galaxy</span>
<span class="l l-Scalar l-Scalar-Plain">ansible-galaxy collection install community.general</span>
<span class="l l-Scalar l-Scalar-Plain">ansible-galaxy collection install ansible.posix</span>
</code></pre></div>
<h3 id="collection-structure">Collection Structure<a class="headerlink" href="#collection-structure" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>my_namespace.my_collection/
├── galaxy.yml
├── plugins/
│   ├── modules/
│   ├── inventory/
│   └── filter/
├── roles/
│   └── my_role/
│       ├── defaults/
│       ├── tasks/
│       ├── handlers/
│       └── meta/
└── playbooks/
</code></pre></div>
<hr />
<h2 id="playbook-structure">Playbook Structure<a class="headerlink" href="#playbook-structure" title="Permanent link">&para;</a></h2>
<h3 id="basic-playbook">Basic Playbook<a class="headerlink" href="#basic-playbook" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="c1">## @module web_server_deployment</span>
<span class="c1">## @description Deploy and configure nginx web servers</span>
<span class="c1">## @dependencies ansible.builtin, community.general</span>
<span class="c1">## @version 1.0.0</span>
<span class="c1">## @author Tyler Dukes</span>
<span class="c1">## @last_updated 2025-10-28</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure web servers</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">nginx_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">    </span><span class="nt">document_root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/www/html</span>

<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install nginx</span>
<span class="w">      </span><span class="nt">ansible.builtin.package</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start and enable nginx</span>
<span class="w">      </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy website content</span>
<span class="w">      </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello World&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">document_root</span><span class="nv"> </span><span class="s">}}/index.html&quot;</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0644&#39;</span>
<span class="w">      </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>

<span class="w">  </span><span class="nt">handlers</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>
<span class="w">      </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reloaded</span>
</code></pre></div>
<h3 id="multi-play-playbook">Multi-Play Playbook<a class="headerlink" href="#multi-play-playbook" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prepare database servers</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dbservers</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install PostgreSQL</span>
<span class="w">      </span><span class="nt">ansible.builtin.package</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql-server</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure application servers</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appservers</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">vars_files</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vars/app_config.yml</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy application</span>
<span class="w">      </span><span class="nt">ansible.builtin.include_role</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_namespace.my_collection.app_deployment</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Update load balancers</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">loadbalancers</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">serial</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Update nginx configuration</span>
<span class="w">      </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx.conf.j2</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">      </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>
</code></pre></div>
<hr />
<h2 id="inventory-organization">Inventory Organization<a class="headerlink" href="#inventory-organization" title="Permanent link">&para;</a></h2>
<h3 id="static-inventory-ini-format">Static Inventory (INI format)<a class="headerlink" href="#static-inventory-ini-format" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">## inventory/production.ini</span>
<span class="k">[webservers]</span>
<span class="na">web1.example.com ansible_host</span><span class="o">=</span><span class="s">192.168.1.10</span>
<span class="na">web2.example.com ansible_host</span><span class="o">=</span><span class="s">192.168.1.11</span>

<span class="k">[dbservers]</span>
<span class="na">db1.example.com ansible_host</span><span class="o">=</span><span class="s">192.168.1.20</span>

<span class="k">[appservers]</span>
<span class="na">app1.example.com</span>
<span class="na">app2.example.com</span>

<span class="k">[production:children]</span>
<span class="na">webservers</span>
<span class="na">dbservers</span>
<span class="na">appservers</span>

<span class="k">[production:vars]</span>
<span class="na">ansible_user</span><span class="o">=</span><span class="s">deploy</span>
<span class="na">ansible_become</span><span class="o">=</span><span class="s">true</span>
<span class="na">environment</span><span class="o">=</span><span class="s">production</span>
</code></pre></div>
<h3 id="static-inventory-yaml-format">Static Inventory (YAML format)<a class="headerlink" href="#static-inventory-yaml-format" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">## inventory/production.yml</span>
<span class="nt">all</span><span class="p">:</span>
<span class="w">  </span><span class="nt">children</span><span class="p">:</span>
<span class="w">    </span><span class="nt">webservers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">        </span><span class="nt">web1.example.com</span><span class="p">:</span>
<span class="w">          </span><span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.10</span>
<span class="w">        </span><span class="nt">web2.example.com</span><span class="p">:</span>
<span class="w">          </span><span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.11</span>
<span class="w">    </span><span class="nt">dbservers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">        </span><span class="nt">db1.example.com</span><span class="p">:</span>
<span class="w">          </span><span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.20</span>
<span class="w">    </span><span class="nt">appservers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app1.example.com</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app2.example.com</span><span class="p">:</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ansible_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">    </span><span class="nt">ansible_become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</code></pre></div>
<h3 id="group-variables">Group Variables<a class="headerlink" href="#group-variables" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>inventory/
├── production.yml
└── group_vars/
    ├── all.yml
    ├── webservers.yml
    └── dbservers.yml
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">## group_vars/webservers.yml</span>
<span class="nn">---</span>
<span class="nt">nginx_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="nt">nginx_worker_processes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="nt">ssl_certificate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssl/certs/example.com.crt</span>
<span class="nt">ssl_certificate_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssl/private/example.com.key</span>
</code></pre></div>
<hr />
<h2 id="variable-precedence">Variable Precedence<a class="headerlink" href="#variable-precedence" title="Permanent link">&para;</a></h2>
<p>Ansible variable precedence (lowest to highest):</p>
<ol>
<li>Command line values (--extra-vars)</li>
<li>Role defaults (defaults/main.yml)</li>
<li>Inventory file or script group vars</li>
<li>Inventory group_vars/all</li>
<li>Playbook group_vars/all</li>
<li>Inventory group_vars/*</li>
<li>Playbook group_vars/*</li>
<li>Inventory file or script host vars</li>
<li>Inventory host_vars/*</li>
<li>Playbook host_vars/*</li>
<li>Host facts / cached set_facts</li>
<li>Play vars</li>
<li>Play vars_prompt</li>
<li>Play vars_files</li>
<li>Role vars (vars/main.yml)</li>
<li>Block vars (only for tasks in block)</li>
<li>Task vars (only for the task)</li>
<li>Include vars</li>
<li>Set_facts / registered vars</li>
<li>Role (and include_role) params</li>
<li>Include params</li>
<li>Extra vars (always win precedence)</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1">## Example showing variable override</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Variable precedence example</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span><span class="w">  </span><span class="c1"># Play vars</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Show port (will use 9000 from task vars)</span>
<span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
<span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Port</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">app_port</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span><span class="w">  </span><span class="c1"># Task vars (higher precedence)</span>
</code></pre></div>
<hr />
<h2 id="role-structure">Role Structure<a class="headerlink" href="#role-structure" title="Permanent link">&para;</a></h2>
<h3 id="modern-role-with-collection">Modern Role with Collection<a class="headerlink" href="#modern-role-with-collection" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>roles/webserver/
├── defaults/
│   └── main.yml          # Default variables (lowest precedence)
├── vars/
│   └── main.yml          # Role variables (higher precedence)
├── tasks/
│   └── main.yml          # Main task list
├── handlers/
│   └── main.yml          # Handler definitions
├── templates/
│   └── nginx.conf.j2     # Jinja2 templates
├── files/
│   └── ssl_cert.crt      # Static files
├── meta/
│   └── main.yml          # Role metadata and dependencies
└── README.md             # Role documentation
</code></pre></div>
<h3 id="role-example">Role Example<a class="headerlink" href="#role-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">## roles/webserver/tasks/main.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install nginx</span>
<span class="w">  </span><span class="nt">ansible.builtin.package</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nginx_package_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create document root</span>
<span class="w">  </span><span class="nt">ansible.builtin.file</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nginx_document_root</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
<span class="w">    </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nginx_user</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nginx_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0755&#39;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy nginx configuration</span>
<span class="w">  </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx.conf.j2</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">    </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx -t -c %s</span>
<span class="w">  </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure nginx is running</span>
<span class="w">  </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">## roles/webserver/defaults/main.yml</span>
<span class="nn">---</span>
<span class="nt">nginx_package_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="nt">nginx_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www-data</span>
<span class="nt">nginx_group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www-data</span>
<span class="nt">nginx_document_root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/www/html</span>
<span class="nt">nginx_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="nt">nginx_worker_processes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">## roles/webserver/meta/main.yml</span>
<span class="nn">---</span>
<span class="nt">galaxy_info</span><span class="p">:</span>
<span class="w">  </span><span class="nt">author</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Tyler Dukes</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure nginx web server</span>
<span class="w">  </span><span class="nt">min_ansible_version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2.15&quot;</span>
<span class="w">  </span><span class="nt">platforms</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ubuntu</span>
<span class="w">      </span><span class="nt">versions</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">focal</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jammy</span>
<span class="w">  </span><span class="nt">galaxy_tags</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>

<span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_namespace.my_collection.common</span>
<span class="w">    </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">      </span><span class="nt">common_packages</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">curl</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vim</span>
</code></pre></div>
<hr />
<h2 id="handlers">Handlers<a class="headerlink" href="#handlers" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="c1">## handlers/main.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>
<span class="w">  </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reloaded</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart nginx</span>
<span class="w">  </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload systemd</span>
<span class="w">  </span><span class="nt">ansible.builtin.systemd</span><span class="p">:</span>
<span class="w">    </span><span class="nt">daemon_reload</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="c1">## Using handlers in tasks</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Update nginx configuration</span>
<span class="w">  </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx.conf.j2</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">  </span><span class="nt">notify</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload systemd</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span><span class="w">  </span><span class="c1"># Handlers run in order defined</span>

<span class="c1">## Force handler execution</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Flush handlers</span>
<span class="w">  </span><span class="nt">ansible.builtin.meta</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flush_handlers</span>
</code></pre></div>
<hr />
<h2 id="jinja2-templates">Jinja2 Templates<a class="headerlink" href="#jinja2-templates" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>{# templates/nginx.conf.j2 #}
user {{ nginx_user }};
worker_processes {{ nginx_worker_processes }};

events {
    worker_connections {{ nginx_worker_connections | default(1024) }};
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    {% for server in nginx_servers %}
    server {
        listen {{ server.port | default(80) }};
        server_name {{ server.name }};
        root {{ server.document_root }};

        {% if server.ssl_enabled | default(false) %}
        ssl_certificate {{ server.ssl_cert }};
        ssl_certificate_key {{ server.ssl_key }};
        {% endif %}

        location / {
            try_files $uri $uri/ =404;
        }
    }
    {% endfor %}
}
</code></pre></div>
<h3 id="jinja2-filters">Jinja2 Filters<a class="headerlink" href="#jinja2-filters" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">## Common filters</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Use filters in templates</span>
<span class="w">  </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
<span class="w">    </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">Uppercase: {{ hostname | upper }}</span>
<span class="w">      </span><span class="no">Lowercase: {{ hostname | lower }}</span>
<span class="w">      </span><span class="no">Default: {{ port | default(8080) }}</span>
<span class="w">      </span><span class="no">String to int: {{ &quot;42&quot; | int }}</span>
<span class="w">      </span><span class="no">Join list: {{ [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;] | join(&#39;,&#39;) }}</span>
<span class="w">      </span><span class="no">Regex replace: {{ &#39;foo bar&#39; | regex_replace(&#39;bar&#39;, &#39;baz&#39;) }}</span>
<span class="w">      </span><span class="no">To JSON: {{ my_dict | to_json }}</span>
<span class="w">      </span><span class="no">To YAML: {{ my_dict | to_nice_yaml }}</span>
</code></pre></div>
<hr />
<h2 id="ansible-vault">Ansible Vault<a class="headerlink" href="#ansible-vault" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="c1">## Create encrypted file</span>
ansible-vault<span class="w"> </span>create<span class="w"> </span>secrets.yml

<span class="c1">## Edit encrypted file</span>
ansible-vault<span class="w"> </span>edit<span class="w"> </span>secrets.yml

<span class="c1">## Encrypt existing file</span>
ansible-vault<span class="w"> </span>encrypt<span class="w"> </span>vars/secrets.yml

<span class="c1">## Decrypt file</span>
ansible-vault<span class="w"> </span>decrypt<span class="w"> </span>vars/secrets.yml

<span class="c1">## View encrypted file</span>
ansible-vault<span class="w"> </span>view<span class="w"> </span>secrets.yml

<span class="c1">## Rekey (change password)</span>
ansible-vault<span class="w"> </span>rekey<span class="w"> </span>secrets.yml
</code></pre></div>
<h3 id="using-vault-in-playbooks">Using Vault in Playbooks<a class="headerlink" href="#using-vault-in-playbooks" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">## Store sensitive data in vault</span>
<span class="c1">## vars/secrets.yml (encrypted)</span>
<span class="nn">---</span>
<span class="nt">db_password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">super_secret_password</span>
<span class="nt">api_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secret_api_key_12345</span>

<span class="c1">## Reference vault file in playbook</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy application</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appservers</span>
<span class="w">  </span><span class="nt">vars_files</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vars/secrets.yml</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure database connection</span>
<span class="w">      </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database.yml.j2</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/app/database.yml</span>
<span class="w">      </span><span class="nt">no_log</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Don&#39;t log sensitive data</span>

<span class="c1">## Run playbook with vault password</span>
<span class="l l-Scalar l-Scalar-Plain">ansible-playbook site.yml --ask-vault-pass</span>
<span class="l l-Scalar l-Scalar-Plain">ansible-playbook site.yml --vault-password-file ~/.vault_pass</span>
</code></pre></div>
<hr />
<h2 id="tags-strategy">Tags Strategy<a class="headerlink" href="#tags-strategy" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Full application deployment</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appservers</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">      </span><span class="nt">ansible.builtin.package</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">      </span><span class="nt">loop</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python3</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python3-pip</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">packages</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dependencies</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy application code</span>
<span class="w">      </span><span class="nt">ansible.builtin.git</span><span class="p">:</span>
<span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/example/app.git</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/app</span>
<span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run database migrations</span>
<span class="w">      </span><span class="nt">ansible.builtin.command</span><span class="p">:</span>
<span class="w">        </span><span class="nt">cmd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python3 manage.py migrate</span>
<span class="w">        </span><span class="nt">chdir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/app</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">migrations</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart application service</span>
<span class="w">      </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restart</span>

<span class="c1">## Run specific tags</span>
<span class="c1">## ansible-playbook site.yml --tags &quot;deploy&quot;</span>
<span class="c1">## ansible-playbook site.yml --tags &quot;packages,database&quot;</span>
<span class="c1">## ansible-playbook site.yml --skip-tags &quot;migrations&quot;</span>
</code></pre></div>
<hr />
<h2 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Error handling examples</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Ignore errors</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Try to stop service (may not exist)</span>
<span class="w">      </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">optional-service</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stopped</span>
<span class="w">      </span><span class="nt">ignore_errors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">    </span><span class="c1"># Conditional failure</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check disk space</span>
<span class="w">      </span><span class="nt">ansible.builtin.shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">df -h / | awk &#39;NR==2 {print $5}&#39; | sed &#39;s/%//&#39;</span>
<span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">disk_usage</span>
<span class="w">      </span><span class="nt">failed_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">disk_usage.stdout | int &gt; 90</span>
<span class="w">      </span><span class="nt">changed_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">    </span><span class="c1"># Custom failure message</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Validate configuration</span>
<span class="w">      </span><span class="nt">ansible.builtin.command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">validate-config.sh</span>
<span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">validation</span>
<span class="w">      </span><span class="nt">failed_when</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">validation.rc != 0</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;&#39;CRITICAL&#39;</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">validation.stderr&quot;</span>

<span class="w">    </span><span class="c1"># Block with rescue</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy with rollback</span>
<span class="w">      </span><span class="nt">block</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy new version</span>
<span class="w">          </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
<span class="w">            </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-v2.jar</span>
<span class="w">            </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/app/app.jar</span>
<span class="w">          </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart app</span>

<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run health check</span>
<span class="w">          </span><span class="nt">ansible.builtin.uri</span><span class="p">:</span>
<span class="w">            </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8080/health</span>
<span class="w">            </span><span class="nt">status_code</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200</span>
<span class="w">          </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">          </span><span class="nt">delay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>

<span class="w">      </span><span class="nt">rescue</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Rollback to previous version</span>
<span class="w">          </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
<span class="w">            </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-v1.jar</span>
<span class="w">            </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/app/app.jar</span>
<span class="w">          </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart app</span>

<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Send alert</span>
<span class="w">          </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
<span class="w">            </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Deployment</span><span class="nv"> </span><span class="s">failed,</span><span class="nv"> </span><span class="s">rolled</span><span class="nv"> </span><span class="s">back</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">v1&quot;</span>

<span class="w">      </span><span class="nt">always</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cleanup temp files</span>
<span class="w">          </span><span class="nt">ansible.builtin.file</span><span class="p">:</span>
<span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/deploy</span>
<span class="w">            </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>
</code></pre></div>
<hr />
<h2 id="testing-with-molecule">Testing with Molecule<a class="headerlink" href="#testing-with-molecule" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="c1">## Initialize molecule scenario</span>
molecule<span class="w"> </span>init<span class="w"> </span>scenario<span class="w"> </span>default

<span class="c1">## Run full test sequence</span>
molecule<span class="w"> </span><span class="nb">test</span>

<span class="c1">## Individual steps</span>
molecule<span class="w"> </span>create<span class="w">       </span><span class="c1"># Create test instances</span>
molecule<span class="w"> </span>converge<span class="w">     </span><span class="c1"># Run playbook</span>
molecule<span class="w"> </span>verify<span class="w">       </span><span class="c1"># Run test assertions</span>
molecule<span class="w"> </span>destroy<span class="w">      </span><span class="c1"># Destroy test instances</span>
</code></pre></div>
<h3 id="molecule-configuration">Molecule Configuration<a class="headerlink" href="#molecule-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">## molecule/default/molecule.yml</span>
<span class="nn">---</span>
<span class="nt">driver</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker</span>

<span class="nt">platforms</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-22.04</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu:22.04</span>
<span class="w">    </span><span class="nt">pre_build_image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="nt">provisioner</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible</span>
<span class="w">  </span><span class="nt">config_options</span><span class="p">:</span>
<span class="w">    </span><span class="nt">defaults</span><span class="p">:</span>
<span class="w">      </span><span class="nt">callbacks_enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">profile_tasks</span>

<span class="nt">verifier</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible</span>

<span class="nt">scenario</span><span class="p">:</span>
<span class="w">  </span><span class="nt">test_sequence</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">destroy</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">create</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">converge</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">verify</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">destroy</span>
</code></pre></div>
<h3 id="molecule-verify">Molecule Verify<a class="headerlink" href="#molecule-verify" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">## molecule/default/verify.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Verify</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check nginx is installed</span>
<span class="w">      </span><span class="nt">ansible.builtin.package</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">      </span><span class="nt">check_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx_check</span>
<span class="w">      </span><span class="nt">failed_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx_check.changed</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check nginx is running</span>
<span class="w">      </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<span class="w">      </span><span class="nt">check_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx_service</span>
<span class="w">      </span><span class="nt">failed_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx_service.changed</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test HTTP response</span>
<span class="w">      </span><span class="nt">ansible.builtin.uri</span><span class="p">:</span>
<span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:80</span>
<span class="w">        </span><span class="nt">return_content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http_response</span>
<span class="w">      </span><span class="nt">failed_when</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&#39;Hello</span><span class="nv"> </span><span class="s">World&#39;</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">http_response.content&quot;</span>
</code></pre></div>
<h3 id="role-testing-best-practices">Role Testing Best Practices<a class="headerlink" href="#role-testing-best-practices" title="Permanent link">&para;</a></h3>
<h4 id="when-to-write-tests">When to Write Tests<a class="headerlink" href="#when-to-write-tests" title="Permanent link">&para;</a></h4>
<p>Write tests for Ansible roles when:</p>
<ul>
<li><strong>Reusable roles</strong>: Any role used across multiple projects, teams, or playbooks</li>
<li><strong>Critical infrastructure</strong>: Roles managing production systems, security configurations, or compliance requirements</li>
<li><strong>Complex logic</strong>: Roles with conditional tasks, dynamic includes, or computed variables</li>
<li><strong>Public roles</strong>: Any role shared on Ansible Galaxy or internally across teams</li>
<li><strong>Compliance requirements</strong>: Roles requiring audit trails or regulatory compliance evidence</li>
</ul>
<h4 id="what-to-test">What to Test<a class="headerlink" href="#what-to-test" title="Permanent link">&para;</a></h4>
<p>Test the following aspects of your Ansible roles:</p>
<ol>
<li><strong>Task Execution</strong>: Verify all tasks execute successfully on target platforms</li>
<li><strong>Idempotency</strong>: Ensure role runs produce no changes on subsequent executions</li>
<li><strong>Service State</strong>: Validate services are running and configured correctly</li>
<li><strong>File Content</strong>: Check configuration files contain expected values</li>
<li><strong>Network Connectivity</strong>: Test ports are open and services are accessible</li>
<li><strong>Security Posture</strong>: Verify permissions, ownership, and security settings</li>
<li><strong>Cross-Platform</strong>: Test on all supported operating systems</li>
</ol>
<h3 id="tiered-testing-strategy">Tiered Testing Strategy<a class="headerlink" href="#tiered-testing-strategy" title="Permanent link">&para;</a></h3>
<p>Implement a three-tier approach to balance speed, coverage, and confidence:</p>
<h4 id="tier-1-static-analysis-30-seconds">Tier 1: Static Analysis (&lt; 30 seconds)<a class="headerlink" href="#tier-1-static-analysis-30-seconds" title="Permanent link">&para;</a></h4>
<p>Fast linting and syntax validation that runs on every commit:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># .pre-commit-config.yaml</span>
<span class="nt">repos</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/ansible/ansible-lint</span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v24.2.0</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible-lint</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">--strict</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">files</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">\.(yaml|yml)$</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/adrienverge/yamllint</span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.35.1</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yamllint</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">-c=.yamllint.yml</span><span class="p p-Indicator">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># .yamllint.yml</span>
<span class="nn">---</span>
<span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>

<span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="nt">line-length</span><span class="p">:</span>
<span class="w">    </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">120</span>
<span class="w">    </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<span class="w">  </span><span class="nt">comments</span><span class="p">:</span>
<span class="w">    </span><span class="nt">min-spaces-from-content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">indentation</span><span class="p">:</span>
<span class="w">    </span><span class="nt">spaces</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">indent-sequences</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># .ansible-lint</span>
<span class="nn">---</span>
<span class="nt">profile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>

<span class="nt">exclude_paths</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.github/</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.cache/</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">molecule/</span>

<span class="nt">skip_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yaml[line-length]</span><span class="w">  </span><span class="c1"># Handled by yamllint</span>

<span class="nt">warn_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">experimental</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">role-name</span>

<span class="nt">enable_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no-same-owner</span><span class="w">  </span><span class="c1"># Ensure different owner/group</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">args</span><span class="w">  </span><span class="c1"># Check task arguments</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">empty-string-compare</span><span class="w">  </span><span class="c1"># Prefer not item.foo</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no-log-password</span><span class="w">  </span><span class="c1"># Mark password tasks with no_log</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">name[casing]</span><span class="w">  </span><span class="c1"># Enforce task name casing</span>
</code></pre></div>
<h4 id="tier-2-role-execution-tests-5-minutes">Tier 2: Role Execution Tests (&lt; 5 minutes)<a class="headerlink" href="#tier-2-role-execution-tests-5-minutes" title="Permanent link">&para;</a></h4>
<p>Molecule converge tests that run on pull requests:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># molecule/default/molecule.yml</span>
<span class="nn">---</span>
<span class="nt">driver</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker</span>

<span class="nt">platforms</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-22.04</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">geerlingguy/docker-ubuntu2204-ansible:latest</span>
<span class="w">    </span><span class="nt">pre_build_image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">privileged</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/lib/systemd/systemd</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/sys/fs/cgroup:/sys/fs/cgroup:ro</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rhel-9</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">geerlingguy/docker-rockylinux9-ansible:latest</span>
<span class="w">    </span><span class="nt">pre_build_image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">privileged</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/sbin/init</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/sys/fs/cgroup:/sys/fs/cgroup:ro</span>

<span class="nt">provisioner</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible</span>
<span class="w">  </span><span class="nt">config_options</span><span class="p">:</span>
<span class="w">    </span><span class="nt">defaults</span><span class="p">:</span>
<span class="w">      </span><span class="nt">callbacks_enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">profile_tasks,timer</span>
<span class="w">      </span><span class="nt">stdout_callback</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yaml</span>
<span class="w">  </span><span class="nt">inventory</span><span class="p">:</span>
<span class="w">    </span><span class="nt">host_vars</span><span class="p">:</span>
<span class="w">      </span><span class="nt">ubuntu-22.04</span><span class="p">:</span>
<span class="w">        </span><span class="nt">ansible_python_interpreter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/bin/python3</span>
<span class="w">      </span><span class="nt">rhel-9</span><span class="p">:</span>
<span class="w">        </span><span class="nt">ansible_python_interpreter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/bin/python3</span>

<span class="nt">verifier</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible</span>

<span class="nt">scenario</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">  </span><span class="nt">test_sequence</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dependency</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cleanup</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">destroy</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">syntax</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">create</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prepare</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">converge</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">idempotence</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">side_effect</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">verify</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cleanup</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">destroy</span>
</code></pre></div>
<h4 id="tier-3-compliance-verification-15-minutes">Tier 3: Compliance Verification (&lt; 15 minutes)<a class="headerlink" href="#tier-3-compliance-verification-15-minutes" title="Permanent link">&para;</a></h4>
<p>InSpec integration for security and compliance testing (nightly or pre-release):</p>
<div class="highlight"><pre><span></span><code><span class="c1"># molecule/compliance/molecule.yml</span>
<span class="nn">---</span>
<span class="nt">driver</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker</span>

<span class="nt">platforms</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-22.04-compliance</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">geerlingguy/docker-ubuntu2204-ansible:latest</span>
<span class="w">    </span><span class="nt">pre_build_image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">privileged</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/lib/systemd/systemd</span>

<span class="nt">provisioner</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible</span>

<span class="nt">verifier</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testinfra</span>
<span class="w">  </span><span class="nt">additional_files_or_dirs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../compliance/</span>
<span class="w">  </span><span class="nt">env</span><span class="p">:</span>
<span class="w">    </span><span class="nt">PYTHONWARNINGS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ignore</span>

<span class="nt">scenario</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compliance</span>
<span class="w">  </span><span class="nt">test_sequence</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">destroy</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">create</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">converge</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">verify</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">destroy</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># molecule/compliance/tests/test_security.rb</span>
<span class="n">control</span><span class="w"> </span><span class="s1">&#39;nginx-security&#39;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="n">title</span><span class="w"> </span><span class="s1">&#39;NGINX Security Configuration&#39;</span>
<span class="w">  </span><span class="n">desc</span><span class="w"> </span><span class="s1">&#39;Verify NGINX is configured securely&#39;</span>

<span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">package</span><span class="p">(</span><span class="s1">&#39;nginx&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_installed</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="k">end</span>

<span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">service</span><span class="p">(</span><span class="s1">&#39;nginx&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_installed</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_enabled</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_running</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="k">end</span>

<span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="s1">&#39;/etc/nginx/nginx.conf&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_file</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_owned_by</span><span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_grouped_into</span><span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should_not</span><span class="w"> </span><span class="n">be_readable</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="s1">&#39;others&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should_not</span><span class="w"> </span><span class="n">be_writable</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="s1">&#39;others&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should_not</span><span class="w"> </span><span class="n">be_executable</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="s1">&#39;others&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="k">end</span>

<span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">nginx_conf</span><span class="p">(</span><span class="s1">&#39;/etc/nginx/nginx.conf&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="n">its</span><span class="p">(</span><span class="s1">&#39;params&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="kp">include</span><span class="w"> </span><span class="s1">&#39;server_tokens&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;off&#39;</span><span class="o">]</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">its</span><span class="p">(</span><span class="s1">&#39;params&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="kp">include</span><span class="w"> </span><span class="s1">&#39;ssl_protocols&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">[[</span><span class="s1">&#39;TLSv1.2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;TLSv1.3&#39;</span><span class="o">]]</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="k">end</span>

<span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">port</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_listening</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">its</span><span class="p">(</span><span class="s1">&#39;protocols&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="kp">include</span><span class="w"> </span><span class="s1">&#39;tcp&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="k">end</span>

<span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">port</span><span class="p">(</span><span class="mi">443</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_listening</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">its</span><span class="p">(</span><span class="s1">&#39;protocols&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="kp">include</span><span class="w"> </span><span class="s1">&#39;tcp&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="k">end</span>

<span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="s1">&#39;/var/www/html&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_directory</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_owned_by</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="k">end</span>
<span class="k">end</span>

<span class="n">control</span><span class="w"> </span><span class="s1">&#39;cis-benchmark&#39;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="n">title</span><span class="w"> </span><span class="s1">&#39;CIS Ubuntu 22.04 Benchmark Checks&#39;</span>
<span class="w">  </span><span class="n">desc</span><span class="w"> </span><span class="s1">&#39;Verify compliance with CIS benchmarks&#39;</span>

<span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="s1">&#39;/etc/ssh/sshd_config&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="n">its</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="sr">/^PermitRootLogin no/</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">its</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="sr">/^PasswordAuthentication no/</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">its</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="sr">/^X11Forwarding no/</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="k">end</span>

<span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="s1">&#39;/etc/audit/auditd.conf&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">its</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="sr">/^max_log_file_action = keep_logs/</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3 id="role-contracts">Role Contracts<a class="headerlink" href="#role-contracts" title="Permanent link">&para;</a></h3>
<p>Define explicit guarantees for each role using a CONTRACT.md file:</p>
<div class="highlight"><pre><span></span><code><span class="gh"># Role Contract: Web Server</span>

<span class="gu">## Purpose</span>
Deploys and configures NGINX web server with TLS support, security hardening, and monitoring.

<span class="gu">## Guarantees</span>

<span class="gu">### Tasks Performed</span>
<span class="k">-</span><span class="w"> </span>Install NGINX from official repository
<span class="k">-</span><span class="w"> </span>Configure virtual hosts with TLS certificates
<span class="k">-</span><span class="w"> </span>Set up security headers and SSL/TLS best practices
<span class="k">-</span><span class="w"> </span>Configure log rotation and monitoring
<span class="k">-</span><span class="w"> </span>Enable and start NGINX service

<span class="gu">### Behavior Guarantees</span>
<span class="k">1.</span> <span class="gs">**Idempotency**</span>: Multiple runs produce no changes after initial deployment
<span class="k">2.</span> <span class="gs">**Service Availability**</span>: NGINX service running and enabled on boot
<span class="k">3.</span> <span class="gs">**Security**</span>: TLS 1.2+ only, server tokens disabled, secure headers configured
<span class="k">4.</span> <span class="gs">**Permissions**</span>: All config files owned by root with 0644, private keys 0600
<span class="k">5.</span> <span class="gs">**Compatibility**</span>: Supports Ubuntu 20.04+, RHEL 8+, Debian 11+

<span class="gu">### Required Variables</span>
<span class="sb">```yaml</span>
<span class="c1"># Required inputs with validation</span>
<span class="nt">nginx_server_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;example.com&quot;</span><span class="w">  </span><span class="c1"># Must be valid FQDN</span>
<span class="nt">nginx_document_root</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/var/www/html&quot;</span><span class="w">  </span><span class="c1"># Must be absolute path</span>
<span class="nt">nginx_ssl_certificate</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/etc/ssl/certs/server.crt&quot;</span><span class="w">  </span><span class="c1"># Must exist</span>
<span class="nt">nginx_ssl_certificate_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/etc/ssl/private/server.key&quot;</span><span class="w">  </span><span class="c1"># Must exist, mode 0600</span>

<span class="c1"># Optional with defaults</span>
<span class="nt">nginx_worker_processes</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;auto&quot;</span><span class="w">  </span><span class="c1"># Number or &#39;auto&#39;</span>
<span class="nt">nginx_worker_connections</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1024</span><span class="w">  </span><span class="c1"># Integer &gt;= 512</span>
<span class="nt">nginx_keepalive_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65</span><span class="w">  </span><span class="c1"># Integer in seconds</span>
<span class="nt">nginx_enable_ssl</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Boolean</span>
<span class="nt">nginx_ssl_protocols</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TLSv1.2</span><span class="nv"> </span><span class="s">TLSv1.3&quot;</span><span class="w">  </span><span class="c1"># String</span>
<span class="sb">```</span>

<span class="gu">### Post-Conditions</span>

After successful execution, the following conditions are guaranteed:

<span class="k">-</span><span class="w"> </span>NGINX package is installed (latest stable version)
<span class="k">-</span><span class="w"> </span>Service is running and enabled
<span class="k">-</span><span class="w"> </span>Port 80 (HTTP) is listening
<span class="k">-</span><span class="w"> </span>Port 443 (HTTPS) is listening if <span class="sb">`nginx_enable_ssl: true`</span>
<span class="k">-</span><span class="w"> </span>Configuration passes <span class="sb">`nginx -t`</span> validation
<span class="k">-</span><span class="w"> </span>Log files exist at <span class="sb">`/var/log/nginx/`</span> with proper rotation
<span class="k">-</span><span class="w"> </span>User <span class="sb">`www-data`</span> exists with appropriate permissions

<span class="gu">### Platform Support Matrix</span>

| Platform | Versions | Status | Notes |
|----------|----------|--------|-------|
| Ubuntu | 20.04, 22.04 | ✅ Tested | Primary support |
| Debian | 11, 12 | ✅ Tested | Full support |
| RHEL | 8, 9 | ✅ Tested | Uses EPEL repo |
| Rocky Linux | 8, 9 | ✅ Tested | RHEL equivalent |
| CentOS Stream | 9 | ⚠️ Experimental | Limited testing |
| Windows | N/A | ❌ Not supported | Use IIS role |

<span class="gu">## Breaking Changes Policy</span>

<span class="gu">### Semantic Versioning</span>

<span class="k">-</span><span class="w"> </span><span class="gs">**Major version bump**</span>: Breaking changes to role interface (variables, tasks, handlers)
<span class="k">-</span><span class="w"> </span><span class="gs">**Minor version bump**</span>: New features, backward-compatible changes
<span class="k">-</span><span class="w"> </span><span class="gs">**Patch version bump**</span>: Bug fixes, documentation updates

<span class="gu">### Deprecation Notice Period</span>

Breaking changes will be:

<span class="k">1.</span> Announced in CHANGELOG.md at least one minor version in advance
<span class="k">2.</span> Marked with deprecation warnings in task output
<span class="k">3.</span> Documented in migration guides with examples

<span class="gu">## Testing Requirements</span>

<span class="gu">### Minimum Test Coverage</span>

<span class="k">-</span><span class="w"> </span>✅ ansible-lint with production profile passes
<span class="k">-</span><span class="w"> </span>✅ yamllint with strict config passes
<span class="k">-</span><span class="w"> </span>✅ Molecule converge succeeds on all supported platforms
<span class="k">-</span><span class="w"> </span>✅ Idempotence test passes (second run makes no changes)
<span class="k">-</span><span class="w"> </span>✅ InSpec security tests pass (if compliance scenario exists)
<span class="k">-</span><span class="w"> </span>✅ Service verification (ports open, service running)

<span class="gu">### CI/CD Requirements</span>

<span class="k">-</span><span class="w"> </span>All tier 1 tests (static analysis) on every commit
<span class="k">-</span><span class="w"> </span>Tier 2 tests (converge + idempotence) on every PR
<span class="k">-</span><span class="w"> </span>Tier 3 tests (compliance) nightly or on release tag

<span class="gu">## Dependencies</span>

<span class="gu">### Role Dependencies</span>

<span class="sb">```yaml</span>
<span class="c1"># meta/main.yml</span>
<span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">common_setup</span>
<span class="w">    </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">      </span><span class="nt">setup_firewall</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ssl_certificates</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx_enable_ssl | bool</span>
<span class="sb">```</span>

<span class="gu">### Collection Dependencies</span>

<span class="k">-</span><span class="w"> </span><span class="sb">`ansible.builtin`</span> (core Ansible modules)
<span class="k">-</span><span class="w"> </span><span class="sb">`community.general`</span> &gt;= 5.0.0 (for advanced features)
<span class="k">-</span><span class="w"> </span><span class="sb">`ansible.posix`</span> &gt;= 1.4.0 (for sysctl, firewall)

<span class="gu">### System Dependencies</span>

<span class="k">-</span><span class="w"> </span>Python 3.8+ on control node
<span class="k">-</span><span class="w"> </span>Python 3.6+ on managed nodes
<span class="k">-</span><span class="w"> </span>OpenSSL 1.1.1+ for TLS support

<span class="gu">## Support and Maintenance</span>

<span class="k">-</span><span class="w"> </span><span class="gs">**Maintained by**</span>: DevOps Team
<span class="k">-</span><span class="w"> </span><span class="gs">**Contact**</span>: &lt;devops@example.com&gt;
<span class="k">-</span><span class="w"> </span><span class="gs">**Documentation**</span>: &lt;https://docs.example.com/roles/web_server&gt;
<span class="k">-</span><span class="w"> </span><span class="gs">**Source**</span>: &lt;https://github.com/example/ansible-roles&gt;
<span class="k">-</span><span class="w"> </span><span class="gs">**License**</span>: MIT
</code></pre></div>
<h3 id="idempotency-verification">Idempotency Verification<a class="headerlink" href="#idempotency-verification" title="Permanent link">&para;</a></h3>
<p>Idempotency is critical for Ansible roles. Ensure roles can be run multiple times without making changes:</p>
<h4 id="testing-idempotency-with-molecule">Testing Idempotency with Molecule<a class="headerlink" href="#testing-idempotency-with-molecule" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Run converge twice and check for changes</span>
molecule<span class="w"> </span>converge
molecule<span class="w"> </span>converge<span class="w">  </span><span class="c1"># Should report 0 changes</span>

<span class="c1"># Or use built-in idempotence test</span>
molecule<span class="w"> </span><span class="nb">test</span><span class="w">  </span><span class="c1"># Includes idempotence check in sequence</span>
</code></pre></div>
<p>Molecule's idempotence test runs the playbook twice and fails if the second run makes any changes:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># molecule/default/molecule.yml - idempotence is built into test_sequence</span>
<span class="nt">scenario</span><span class="p">:</span>
<span class="w">  </span><span class="nt">test_sequence</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">destroy</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">create</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">converge</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">idempotence</span><span class="w">  </span><span class="c1"># Fails if second converge makes changes</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">verify</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">destroy</span>
</code></pre></div>
<h4 id="common-idempotency-issues">Common Idempotency Issues<a class="headerlink" href="#common-idempotency-issues" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># BAD - Always reports changed</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure application</span>
<span class="w">  </span><span class="nt">ansible.builtin.shell</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">echo &quot;config=true&quot; &gt;&gt; /etc/app.conf</span>
<span class="w">  </span><span class="c1"># Always appends, never idempotent</span>

<span class="c1"># GOOD - Idempotent configuration</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure application</span>
<span class="w">  </span><span class="nt">ansible.builtin.lineinfile</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/app.conf</span>
<span class="w">    </span><span class="nt">line</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;config=true&quot;</span>
<span class="w">    </span><span class="nt">create</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="c1"># Only adds line if not present</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># BAD - Timestamp always changes</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy configuration</span>
<span class="w">  </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config.j2</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/app/config.yml</span>
<span class="w">  </span><span class="c1"># If template includes {{ ansible_date_time }}, always changes</span>

<span class="c1"># GOOD - Stable template</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy configuration</span>
<span class="w">  </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config.j2</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/app/config.yml</span>
<span class="w">  </span><span class="c1"># Template content deterministic, only changes when needed</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># BAD - Command module always shows changed</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create user</span>
<span class="w">  </span><span class="nt">ansible.builtin.command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">useradd myuser</span>
<span class="w">  </span><span class="c1"># Fails on subsequent runs, not idempotent</span>

<span class="c1"># GOOD - User module is idempotent</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create user</span>
<span class="w">  </span><span class="nt">ansible.builtin.user</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myuser</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">  </span><span class="c1"># Creates user if absent, no change if exists</span>
</code></pre></div>
<h3 id="multi-platform-testing">Multi-Platform Testing<a class="headerlink" href="#multi-platform-testing" title="Permanent link">&para;</a></h3>
<p>Test roles across different operating systems and versions:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># molecule/multi-platform/molecule.yml</span>
<span class="nn">---</span>
<span class="nt">driver</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker</span>

<span class="nt">platforms</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Debian family</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-20-04</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">geerlingguy/docker-ubuntu2004-ansible:latest</span>
<span class="w">    </span><span class="nt">pre_build_image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">privileged</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/lib/systemd/systemd</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-22-04</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">geerlingguy/docker-ubuntu2204-ansible:latest</span>
<span class="w">    </span><span class="nt">pre_build_image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">privileged</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/lib/systemd/systemd</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">debian-11</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">geerlingguy/docker-debian11-ansible:latest</span>
<span class="w">    </span><span class="nt">pre_build_image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">privileged</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/lib/systemd/systemd</span>

<span class="w">  </span><span class="c1"># RHEL family</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rhel-8</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">geerlingguy/docker-rockylinux8-ansible:latest</span>
<span class="w">    </span><span class="nt">pre_build_image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">privileged</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/sbin/init</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rhel-9</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">geerlingguy/docker-rockylinux9-ansible:latest</span>
<span class="w">    </span><span class="nt">pre_build_image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">privileged</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/sbin/init</span>

<span class="w">  </span><span class="c1"># Windows (requires different driver)</span>
<span class="w">  </span><span class="c1"># - name: windows-2022</span>
<span class="w">  </span><span class="c1">#   image: jborean93/ansible-windows:2022</span>
<span class="w">  </span><span class="c1">#   pre_build_image: true</span>

<span class="nt">provisioner</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible</span>
<span class="w">  </span><span class="nt">inventory</span><span class="p">:</span>
<span class="w">    </span><span class="nt">group_vars</span><span class="p">:</span>
<span class="w">      </span><span class="nt">all</span><span class="p">:</span>
<span class="w">        </span><span class="nt">ansible_python_interpreter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/bin/python3</span>
<span class="w">    </span><span class="nt">host_vars</span><span class="p">:</span>
<span class="w">      </span><span class="nt">ubuntu-20-04</span><span class="p">:</span>
<span class="w">        </span><span class="nt">nginx_package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">      </span><span class="nt">ubuntu-22-04</span><span class="p">:</span>
<span class="w">        </span><span class="nt">nginx_package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">      </span><span class="nt">debian-11</span><span class="p">:</span>
<span class="w">        </span><span class="nt">nginx_package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">      </span><span class="nt">rhel-8</span><span class="p">:</span>
<span class="w">        </span><span class="nt">nginx_package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">nginx_service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">      </span><span class="nt">rhel-9</span><span class="p">:</span>
<span class="w">        </span><span class="nt">nginx_package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">nginx_service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>

<span class="nt">verifier</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible</span>

<span class="nt">scenario</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">multi-platform</span>
<span class="w">  </span><span class="nt">test_sequence</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">destroy</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">create</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">converge</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">idempotence</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">verify</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">destroy</span>
</code></pre></div>
<h4 id="platform-specific-tasks">Platform-Specific Tasks<a class="headerlink" href="#platform-specific-tasks" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># tasks/main.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Include OS-specific variables</span>
<span class="w">  </span><span class="nt">ansible.builtin.include_vars</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_os_family</span><span class="nv"> </span><span class="s">}}.yml&quot;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install NGINX (Debian/Ubuntu)</span>
<span class="w">  </span><span class="nt">ansible.builtin.apt</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nginx_package</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="nt">update_cache</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install NGINX (RHEL/Rocky)</span>
<span class="w">  </span><span class="nt">ansible.builtin.yum</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nginx_package</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="nt">enablerepo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">epel</span>
<span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;RedHat&quot;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure NGINX</span>
<span class="w">  </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;nginx.conf.j2&quot;</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nginx_config_path</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">    </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0644&#39;</span>
<span class="w">  </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload NGINX</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># vars/Debian.yml</span>
<span class="nn">---</span>
<span class="nt">nginx_package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="nt">nginx_config_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="nt">nginx_service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="nt">nginx_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www-data</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># vars/RedHat.yml</span>
<span class="nn">---</span>
<span class="nt">nginx_package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="nt">nginx_config_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="nt">nginx_service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="nt">nginx_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</code></pre></div>
<h3 id="cicd-integration">CI/CD Integration<a class="headerlink" href="#cicd-integration" title="Permanent link">&para;</a></h3>
<h4 id="github-actions-pipeline">GitHub Actions Pipeline<a class="headerlink" href="#github-actions-pipeline" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># .github/workflows/ansible-ci.yml</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ansible Role CI</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">]</span>

<span class="nt">env</span><span class="p">:</span>
<span class="w">  </span><span class="nt">PYTHON_VERSION</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.11&#39;</span>
<span class="w">  </span><span class="nt">ANSIBLE_VERSION</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2.16&#39;</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Tier 1: Fast Static Analysis</span>
<span class="w">  </span><span class="nt">lint</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Lint</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v5</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ env.PYTHON_VERSION }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">pip install ansible-lint yamllint ansible==${{ env.ANSIBLE_VERSION }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run yamllint</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yamllint .</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run ansible-lint</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible-lint --strict</span>

<span class="w">  </span><span class="c1"># Tier 2: Molecule Tests</span>
<span class="w">  </span><span class="nt">molecule</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Molecule Test (${{ matrix.distro }})</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lint</span>
<span class="w">    </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">fail-fast</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="nt">matrix</span><span class="p">:</span>
<span class="w">        </span><span class="nt">distro</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu2204</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">debian11</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rockylinux9</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v5</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ env.PYTHON_VERSION }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">pip install molecule[docker] ansible==${{ env.ANSIBLE_VERSION }}</span>
<span class="w">          </span><span class="no">pip install molecule-plugins[docker]</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Molecule</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">molecule test</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">MOLECULE_DISTRO</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.distro }}</span>
<span class="w">          </span><span class="nt">PY_COLORS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">          </span><span class="nt">ANSIBLE_FORCE_COLOR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload molecule logs</span>
<span class="w">        </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">failure()</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/upload-artifact@v4</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">molecule-logs-${{ matrix.distro }}</span>
<span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">            </span><span class="no">molecule/default/*.log</span>
<span class="w">            </span><span class="no">/tmp/molecule/**</span>

<span class="w">  </span><span class="c1"># Tier 3: Compliance Tests (only on main branch)</span>
<span class="w">  </span><span class="nt">compliance</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Compliance Tests</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">molecule</span>
<span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.ref == &#39;refs/heads/main&#39;</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v5</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ env.PYTHON_VERSION }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">pip install molecule[docker] ansible==${{ env.ANSIBLE_VERSION }}</span>
<span class="w">          </span><span class="no">pip install inspec-bin</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run compliance scenario</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">molecule test -s compliance</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload compliance reports</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/upload-artifact@v4</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compliance-reports</span>
<span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">molecule/compliance/reports/</span>
</code></pre></div>
<h4 id="gitlab-ci-pipeline">GitLab CI Pipeline<a class="headerlink" href="#gitlab-ci-pipeline" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># .gitlab-ci.yml</span>
<span class="nn">---</span>
<span class="nt">stages</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lint</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compliance</span>

<span class="nt">variables</span><span class="p">:</span>
<span class="w">  </span><span class="nt">PYTHON_VERSION</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.11&quot;</span>
<span class="w">  </span><span class="nt">ANSIBLE_VERSION</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2.16&quot;</span>
<span class="w">  </span><span class="nt">PIP_CACHE_DIR</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$CI_PROJECT_DIR/.cache/pip&quot;</span>

<span class="nt">cache</span><span class="p">:</span>
<span class="w">  </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.cache/pip</span>

<span class="c1"># Tier 1: Static Analysis</span>
<span class="nt">yamllint</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lint</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:${PYTHON_VERSION}</span>
<span class="w">  </span><span class="nt">before_script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install yamllint</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yamllint .</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;$CI_PIPELINE_SOURCE</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&quot;merge_request_event&quot;&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;$CI_COMMIT_BRANCH</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&quot;main&quot;&#39;</span>

<span class="nt">ansible-lint</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lint</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:${PYTHON_VERSION}</span>
<span class="w">  </span><span class="nt">before_script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install ansible-lint ansible==${ANSIBLE_VERSION}</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible-lint --strict</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;$CI_PIPELINE_SOURCE</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&quot;merge_request_event&quot;&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;$CI_COMMIT_BRANCH</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&quot;main&quot;&#39;</span>

<span class="c1"># Tier 2: Molecule Tests</span>
<span class="nt">.molecule_template</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;molecule_template</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:${PYTHON_VERSION}</span>
<span class="w">  </span><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker:dind</span>
<span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
<span class="w">    </span><span class="nt">DOCKER_HOST</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp://docker:2375</span>
<span class="w">    </span><span class="nt">DOCKER_TLS_CERTDIR</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">  </span><span class="nt">before_script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install molecule[docker] ansible==${ANSIBLE_VERSION}</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install molecule-plugins[docker]</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">molecule test</span>
<span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">on_failure</span>
<span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">molecule/default/*.log</span>
<span class="w">    </span><span class="nt">expire_in</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1 week</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;$CI_PIPELINE_SOURCE</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&quot;merge_request_event&quot;&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;$CI_COMMIT_BRANCH</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&quot;main&quot;&#39;</span>

<span class="nt">molecule-ubuntu</span><span class="p">:</span>
<span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*molecule_template</span>
<span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
<span class="w">    </span><span class="nt">MOLECULE_DISTRO</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu2204</span>

<span class="nt">molecule-debian</span><span class="p">:</span>
<span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*molecule_template</span>
<span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
<span class="w">    </span><span class="nt">MOLECULE_DISTRO</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">debian11</span>

<span class="nt">molecule-rocky</span><span class="p">:</span>
<span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*molecule_template</span>
<span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
<span class="w">    </span><span class="nt">MOLECULE_DISTRO</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rockylinux9</span>

<span class="c1"># Tier 3: Compliance</span>
<span class="nt">compliance</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compliance</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:${PYTHON_VERSION}</span>
<span class="w">  </span><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker:dind</span>
<span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
<span class="w">    </span><span class="nt">DOCKER_HOST</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp://docker:2375</span>
<span class="w">    </span><span class="nt">DOCKER_TLS_CERTDIR</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">  </span><span class="nt">before_script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install molecule[docker] ansible==${ANSIBLE_VERSION}</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install inspec-bin</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">molecule test -s compliance</span>
<span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">molecule/compliance/reports/</span>
<span class="w">    </span><span class="nt">expire_in</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30 days</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;$CI_COMMIT_BRANCH</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&quot;main&quot;&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;$CI_PIPELINE_SOURCE</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&quot;schedule&quot;&#39;</span>
</code></pre></div>
<h3 id="test-coverage-requirements">Test Coverage Requirements<a class="headerlink" href="#test-coverage-requirements" title="Permanent link">&para;</a></h3>
<p>Establish minimum coverage thresholds for roles:</p>
<h4 id="coverage-metrics">Coverage Metrics<a class="headerlink" href="#coverage-metrics" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Task Coverage</strong>: All tasks executed at least once in tests</li>
<li><strong>Platform Coverage</strong>: Tested on all supported OS families</li>
<li><strong>Variable Coverage</strong>: All required and optional variables tested</li>
<li><strong>Handler Coverage</strong>: All handlers triggered and verified</li>
<li><strong>Conditional Coverage</strong>: All <code>when</code> conditions tested (true/false paths)</li>
<li><strong>Error Coverage</strong>: Error handling tested with invalid inputs</li>
</ol>
<h4 id="measuring-coverage">Measuring Coverage<a class="headerlink" href="#measuring-coverage" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># molecule/default/verify.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Verify role behavior</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Service state verification</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check service is running</span>
<span class="w">      </span><span class="nt">ansible.builtin.service_facts</span><span class="p">:</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Assert NGINX is running</span>
<span class="w">      </span><span class="nt">ansible.builtin.assert</span><span class="p">:</span>
<span class="w">        </span><span class="nt">that</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;&#39;nginx&#39;</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">services&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;services[&#39;nginx&#39;].state</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&#39;running&#39;&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;services[&#39;nginx&#39;].status</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&#39;enabled&#39;&quot;</span>
<span class="w">        </span><span class="nt">fail_msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NGINX</span><span class="nv"> </span><span class="s">service</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">running</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">enabled&quot;</span>

<span class="w">    </span><span class="c1"># Port verification</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check HTTP port is listening</span>
<span class="w">      </span><span class="nt">ansible.builtin.wait_for</span><span class="p">:</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<span class="w">        </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check HTTPS port is listening</span>
<span class="w">      </span><span class="nt">ansible.builtin.wait_for</span><span class="p">:</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<span class="w">        </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx_enable_ssl | default(true) | bool</span>

<span class="w">    </span><span class="c1"># Configuration file verification</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check NGINX config exists</span>
<span class="w">      </span><span class="nt">ansible.builtin.stat</span><span class="p">:</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx_conf</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Assert NGINX config is correct</span>
<span class="w">      </span><span class="nt">ansible.builtin.assert</span><span class="p">:</span>
<span class="w">        </span><span class="nt">that</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx_conf.stat.exists</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx_conf.stat.mode == &#39;0644&#39;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx_conf.stat.pw_name == &#39;root&#39;</span>

<span class="w">    </span><span class="c1"># Content verification</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Read NGINX config</span>
<span class="w">      </span><span class="nt">ansible.builtin.slurp</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx_config_content</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Verify security headers</span>
<span class="w">      </span><span class="nt">ansible.builtin.assert</span><span class="p">:</span>
<span class="w">        </span><span class="nt">that</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;&#39;server_tokens</span><span class="nv"> </span><span class="s">off&#39;</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">nginx_config_content[&#39;content&#39;]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">b64decode&quot;</span>
<span class="w">        </span><span class="nt">fail_msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Security</span><span class="nv"> </span><span class="s">headers</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">configured&quot;</span>

<span class="w">    </span><span class="c1"># HTTP response verification</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test HTTP response</span>
<span class="w">      </span><span class="nt">ansible.builtin.uri</span><span class="p">:</span>
<span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost</span>
<span class="w">        </span><span class="nt">return_content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">status_code</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200</span>
<span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http_response</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Verify response content</span>
<span class="w">      </span><span class="nt">ansible.builtin.assert</span><span class="p">:</span>
<span class="w">        </span><span class="nt">that</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http_response.status == 200</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;&#39;nginx&#39;</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">http_response.server.lower()&quot;</span>

<span class="w">    </span><span class="c1"># Log file verification</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check log files exist</span>
<span class="w">      </span><span class="nt">ansible.builtin.stat</span><span class="p">:</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log_files</span>
<span class="w">      </span><span class="nt">loop</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/nginx/access.log</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/nginx/error.log</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Assert log files configured</span>
<span class="w">      </span><span class="nt">ansible.builtin.assert</span><span class="p">:</span>
<span class="w">        </span><span class="nt">that</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">item.stat.exists</span>
<span class="w">        </span><span class="nt">fail_msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Log</span><span class="nv"> </span><span class="s">file</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.item</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">does</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">exist&quot;</span>
<span class="w">      </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">log_files.results</span><span class="nv"> </span><span class="s">}}&quot;</span>
</code></pre></div>
<h4 id="role-readme-testing-section">Role README Testing Section<a class="headerlink" href="#role-readme-testing-section" title="Permanent link">&para;</a></h4>
<p>Include testing instructions in role README:</p>
<div class="highlight"><pre><span></span><code><span class="gu">## Testing</span>

This role includes comprehensive tests using Molecule and InSpec.

<span class="gu">### Prerequisites</span>
<span class="k">-</span><span class="w"> </span>Docker (for Molecule container-based testing)
<span class="k">-</span><span class="w"> </span>Python 3.8+
<span class="k">-</span><span class="w"> </span>pip packages: <span class="sb">`molecule[docker]`</span>, <span class="sb">`ansible-lint`</span>, <span class="sb">`yamllint`</span>

<span class="gu">### Quick Start</span>
<span class="sb">```bash</span>
<span class="c1"># Install dependencies</span>
pip<span class="w"> </span>install<span class="w"> </span>molecule<span class="o">[</span>docker<span class="o">]</span><span class="w"> </span>molecule-plugins<span class="o">[</span>docker<span class="o">]</span><span class="w"> </span>ansible-lint<span class="w"> </span>yamllint

<span class="c1"># Run full test suite</span>
molecule<span class="w"> </span><span class="nb">test</span>

<span class="c1"># Run specific scenarios</span>
molecule<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-s<span class="w"> </span>default<span class="w">      </span><span class="c1"># Default platform tests</span>
molecule<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-s<span class="w"> </span>compliance<span class="w">   </span><span class="c1"># Security compliance tests</span>
molecule<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-s<span class="w"> </span>multi-platform<span class="w">  </span><span class="c1"># All supported platforms</span>
<span class="sb">```</span>

<span class="gu">### Test Scenarios</span>

<span class="gu">#### Default Scenario</span>

Tests role on Ubuntu 22.04 with default variables:

<span class="sb">```bash</span>
molecule<span class="w"> </span>converge<span class="w">  </span><span class="c1"># Deploy role</span>
molecule<span class="w"> </span>verify<span class="w">    </span><span class="c1"># Run assertions</span>
molecule<span class="w"> </span>destroy<span class="w">   </span><span class="c1"># Clean up</span>
<span class="sb">```</span>

<span class="gu">#### Compliance Scenario</span>

Runs InSpec security and compliance tests:

<span class="sb">```bash</span>
molecule<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-s<span class="w"> </span>compliance
<span class="sb">```</span>

<span class="gu">#### Multi-Platform Scenario</span>

Tests across Ubuntu, Debian, and RHEL:

<span class="sb">```bash</span>
molecule<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-s<span class="w"> </span>multi-platform
<span class="sb">```</span>

<span class="gu">### Continuous Integration</span>

All tests run automatically on:

<span class="k">-</span><span class="w"> </span>Every commit: Static analysis (lint)
<span class="k">-</span><span class="w"> </span>Every PR: Molecule converge and idempotence tests
<span class="k">-</span><span class="w"> </span>Main branch: Full compliance suite
<span class="k">-</span><span class="w"> </span>Nightly: Multi-platform tests

<span class="gu">### Coverage Reports</span>

Test coverage reports are generated in <span class="sb">`molecule/reports/`</span>:

<span class="k">-</span><span class="w"> </span><span class="sb">`coverage.json`</span>: Task and platform coverage
<span class="k">-</span><span class="w"> </span><span class="sb">`compliance.json`</span>: InSpec compliance results
<span class="k">-</span><span class="w"> </span><span class="sb">`idempotence.log`</span>: Idempotence test output
</code></pre></div>
<hr />
<h2 id="common-pitfalls">Common Pitfalls<a class="headerlink" href="#common-pitfalls" title="Permanent link">&para;</a></h2>
<h3 id="variable-precedence-confusion">Variable Precedence Confusion<a class="headerlink" href="#variable-precedence-confusion" title="Permanent link">&para;</a></h3>
<p><strong>Issue</strong>: Ansible has 22 levels of variable precedence, and misunderstanding this order causes
unexpected variable values at runtime.</p>
<p><strong>Example</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">## playbook.yml</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy application</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span><span class="w">  </span><span class="c1"># Play vars (precedence: 12)</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy_app</span>
<span class="w">      </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span><span class="w">  </span><span class="c1"># Role params (precedence: 20)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">## roles/deploy_app/defaults/main.yml</span>
<span class="nt">app_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3000</span><span class="w">  </span><span class="c1"># Role defaults (precedence: 2)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">## group_vars/webservers.yml</span>
<span class="nt">app_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5000</span><span class="w">  </span><span class="c1"># Group vars (precedence: 7)</span>
</code></pre></div>
<p><strong>Solution</strong>: Use extra vars (highest precedence) for overrides, role defaults for fallbacks,
and document which vars are meant to be overridden.</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Good - Clear hierarchy</span>
<span class="c1">## ansible-playbook site.yml -e &quot;app_port=9000&quot;  # Extra vars always win</span>
</code></pre></div>
<p><strong>Key Points</strong>:</p>
<ul>
<li>Extra vars (<code>-e</code> or <code>--extra-vars</code>) always win (precedence 22)</li>
<li>Role vars override almost everything (precedence 15)</li>
<li>Use role defaults for sensible fallback values</li>
<li>Document expected override points in role README</li>
</ul>
<h3 id="handler-notification-timing">Handler Notification Timing<a class="headerlink" href="#handler-notification-timing" title="Permanent link">&para;</a></h3>
<p><strong>Issue</strong>: Handlers only run at the end of a play, not immediately when notified, causing race conditions.</p>
<p><strong>Example</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - Config updated but service not reloaded yet</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Update nginx config</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx.conf.j2</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">  </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test nginx configuration</span><span class="w">  </span><span class="c1"># Runs BEFORE reload!</span>
<span class="w">  </span><span class="nt">uri</span><span class="p">:</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost/health</span>
<span class="w">    </span><span class="nt">status_code</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200</span>
</code></pre></div>
<p><strong>Solution</strong>: Use <code>meta: flush_handlers</code> to force handler execution at specific points.</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Good - Force handler execution before testing</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Update nginx config</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx.conf.j2</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">  </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Flush handlers</span>
<span class="w">  </span><span class="nt">meta</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flush_handlers</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test nginx configuration</span><span class="w">  </span><span class="c1"># Now runs AFTER reload</span>
<span class="w">  </span><span class="nt">uri</span><span class="p">:</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost/health</span>
<span class="w">    </span><span class="nt">status_code</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200</span>
</code></pre></div>
<p><strong>Key Points</strong>:</p>
<ul>
<li>Handlers run at play end by default</li>
<li>Use <code>meta: flush_handlers</code> to force immediate execution</li>
<li>Handlers run once even if notified multiple times</li>
<li>Failed tasks prevent handler execution unless <code>force_handlers: true</code></li>
</ul>
<h3 id="changed-when-detection">Changed When Detection<a class="headerlink" href="#changed-when-detection" title="Permanent link">&para;</a></h3>
<p><strong>Issue</strong>: Shell/command tasks always report "changed" status, polluting change reports and
triggering unnecessary handler notifications.</p>
<p><strong>Example</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - Always shows as changed</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check if file exists</span>
<span class="w">  </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test -f /etc/myapp/config.yml</span>
<span class="w">  </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config_check</span>
<span class="w">  </span><span class="nt">ignore_errors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p><strong>Solution</strong>: Use <code>changed_when</code> to properly indicate actual changes.</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Good - Only marks as changed when appropriate</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check if file exists</span>
<span class="w">  </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test -f /etc/myapp/config.yml</span>
<span class="w">  </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config_check</span>
<span class="w">  </span><span class="nt">failed_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">changed_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># This is just a check, not a change</span>

<span class="c1">## Good - Detect actual changes</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Add user to group</span>
<span class="w">  </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">usermod -aG docker {{ username }}</span>
<span class="w">  </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">usermod_result</span>
<span class="w">  </span><span class="nt">changed_when</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&#39;no</span><span class="nv"> </span><span class="s">changes&#39;</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">usermod_result.stderr&quot;</span>
</code></pre></div>
<p><strong>Key Points</strong>:</p>
<ul>
<li>Commands/shell tasks default to "changed" status</li>
<li>Use <code>changed_when: false</code> for read-only operations</li>
<li>Parse output to detect actual changes</li>
<li>Prevents unnecessary handler notifications</li>
</ul>
<h3 id="loop-variable-shadowing">Loop Variable Shadowing<a class="headerlink" href="#loop-variable-shadowing" title="Permanent link">&para;</a></h3>
<p><strong>Issue</strong>: Using <code>loop</code> creates an <code>item</code> variable that shadows outer loop variables, causing nested loop failures.</p>
<p><strong>Example</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - Inner loop shadows outer &#39;item&#39;</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create user directories</span>
<span class="w">  </span><span class="nt">file</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/home/{{</span><span class="nv"> </span><span class="s">item.username</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w">  </span><span class="c1"># Which &#39;item&#39;?</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
<span class="w">  </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">users</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">documents</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">downloads</span>
</code></pre></div>
<p><strong>Solution</strong>: Use <code>loop_control</code> to rename loop variables.</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Good - Explicit loop variable names</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create user directories</span>
<span class="w">  </span><span class="nt">file</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/home/{{</span><span class="nv"> </span><span class="s">user.username</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">folder</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
<span class="w">  </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">users</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">loop_control</span><span class="p">:</span>
<span class="w">    </span><span class="nt">loop_var</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
<span class="w">  </span><span class="nt">with_nested</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">users</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;documents&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;downloads&#39;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">loop_control</span><span class="p">:</span>
<span class="w">    </span><span class="nt">loop_var</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">folder</span>
</code></pre></div>
<p><strong>Key Points</strong>:</p>
<ul>
<li>Default loop variable is <code>item</code></li>
<li>Nested loops shadow outer <code>item</code> variables</li>
<li>Use <code>loop_control: { loop_var: custom_name }</code> for clarity</li>
<li>Name loop variables descriptively</li>
</ul>
<h3 id="template-rendering-errors">Template Rendering Errors<a class="headerlink" href="#template-rendering-errors" title="Permanent link">&para;</a></h3>
<p><strong>Issue</strong>: Jinja2 template errors only appear at runtime on target hosts, making debugging difficult.</p>
<p><strong>Example</strong>:</p>
<div class="highlight"><pre><span></span><code>{# templates/config.j2 - Runtime error! #}
server_url = {{ api_url }}  # Missing quotes for string value
database_host = {{ db_host | default(localhost) }}  # Undefined variable &#39;localhost&#39;
workers = {{ worker_count + 10 }}  # TypeError if worker_count is string
</code></pre></div>
<p><strong>Solution</strong>: Use proper Jinja2 syntax, test templates locally, and use <code>template</code> module's <code>validate</code> parameter.</p>
<div class="highlight"><pre><span></span><code>## Good - Proper Jinja2 syntax
server_url = &quot;{{ api_url }}&quot;
database_host = &quot;{{ db_host | default(&#39;localhost&#39;) }}&quot;
workers = {{ worker_count | int + 10 }}

{# Use filters for type conversion #}
enabled = {{ feature_enabled | bool }}
timeout = {{ timeout_seconds | int }}
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">## Good - Validate template after deployment</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy nginx config</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx.conf.j2</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">    </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;nginx</span><span class="nv"> </span><span class="s">-t</span><span class="nv"> </span><span class="s">-c</span><span class="nv"> </span><span class="s">%s&#39;</span><span class="w">  </span><span class="c1"># Test config before replacing</span>
</code></pre></div>
<p><strong>Key Points</strong>:</p>
<ul>
<li>Quote string values in templates</li>
<li>Use <code>| default('value')</code> with quotes for string defaults</li>
<li>Use type filters: <code>| int</code>, <code>| bool</code>, <code>| string</code></li>
<li>Use <code>validate</code> parameter to test rendered configs</li>
<li>Test templates with <code>--check --diff</code> mode</li>
</ul>
<h3 id="fact-gathering-performance">Fact Gathering Performance<a class="headerlink" href="#fact-gathering-performance" title="Permanent link">&para;</a></h3>
<p><strong>Issue</strong>: Fact gathering runs on every play by default, adding 2-5 seconds per host even when facts aren't needed.</p>
<p><strong>Example</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - Gathers facts unnecessarily</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Simple file copy</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span><span class="w">  </span><span class="c1"># Waits 3 seconds gathering facts we don&#39;t use</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy file</span>
<span class="w">      </span><span class="nt">copy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app.jar</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/app/</span>
</code></pre></div>
<p><strong>Solution</strong>: Disable fact gathering when not needed, use smart gathering, or cache facts.</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Good - Disable when not needed</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Simple file copy</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># Skip fact gathering</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy file</span>
<span class="w">      </span><span class="nt">copy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app.jar</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/app/</span>

<span class="c1">## Good - Use smart gathering (ansible.cfg)</span>
<span class="c1">## [defaults]</span>
<span class="c1">## gathering = smart</span>
<span class="c1">## fact_caching = jsonfile</span>
<span class="c1">## fact_caching_connection = /tmp/ansible_facts</span>
<span class="c1">## fact_caching_timeout = 3600</span>
</code></pre></div>
<p><strong>Key Points</strong>:</p>
<ul>
<li>Default gathering adds 2-5s per host per play</li>
<li>Set <code>gather_facts: false</code> when facts aren't needed</li>
<li>Use <code>gathering = smart</code> to cache facts</li>
<li>Manually gather facts with <code>setup</code> module when needed</li>
<li>Use <code>gather_subset</code> to collect only required facts</li>
</ul>
<hr />
<h2 id="anti-patterns">Anti-Patterns<a class="headerlink" href="#anti-patterns" title="Permanent link">&para;</a></h2>
<h3 id="avoid-shellcommand-for-everything">❌ Avoid: Shell/Command for Everything<a class="headerlink" href="#avoid-shellcommand-for-everything" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - Using shell when module exists</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install package</span>
<span class="w">  </span><span class="nt">ansible.builtin.shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apt-get install -y nginx</span>

<span class="c1">## Good - Use appropriate module</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install package</span>
<span class="w">  </span><span class="nt">ansible.builtin.package</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</code></pre></div>
<h3 id="avoid-hardcoded-values">❌ Avoid: Hardcoded Values<a class="headerlink" href="#avoid-hardcoded-values" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - Hardcoded paths and values</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy config</span>
<span class="w">  </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app.conf</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/myapp/config/app.conf</span>
<span class="w">    </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0644&#39;</span>

<span class="c1">## Good - Use variables</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy config</span>
<span class="w">  </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app.conf</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">app_config_dir</span><span class="nv"> </span><span class="s">}}/app.conf&quot;</span>
<span class="w">    </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">app_user</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">app_config_mode</span><span class="nv"> </span><span class="s">}}&quot;</span>
</code></pre></div>
<h3 id="avoid-no-idempotency">❌ Avoid: No Idempotency<a class="headerlink" href="#avoid-no-idempotency" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - Not idempotent (runs every time)</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Download file</span>
<span class="w">  </span><span class="nt">ansible.builtin.command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wget https://example.com/file.tar.gz</span>
<span class="w">  </span><span class="nt">args</span><span class="p">:</span>
<span class="w">    </span><span class="nt">chdir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>

<span class="c1">## Good - Idempotent check</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Download file</span>
<span class="w">  </span><span class="nt">ansible.builtin.get_url</span><span class="p">:</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://example.com/file.tar.gz</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/file.tar.gz</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0644&#39;</span>
</code></pre></div>
<h3 id="avoid-ignoring-return-codes">❌ Avoid: Ignoring Return Codes<a class="headerlink" href="#avoid-ignoring-return-codes" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - Ignoring all errors</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Stop service</span>
<span class="w">  </span><span class="nt">ansible.builtin.command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">systemctl stop myapp</span>
<span class="w">  </span><span class="nt">ignore_errors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="c1">## Good - Specific error handling</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Stop service</span>
<span class="w">  </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stopped</span>
<span class="w">  </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_stop</span>
<span class="w">  </span><span class="nt">failed_when</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_stop.failed</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;&#39;could</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">found&#39;</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">service_stop.msg&quot;</span>
</code></pre></div>
<h3 id="avoid-not-using-roles">❌ Avoid: Not Using Roles<a class="headerlink" href="#avoid-not-using-roles" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - Everything in one massive playbook</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure web server</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install nginx</span>
<span class="w">      </span><span class="nt">ansible.builtin.package</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy nginx config</span>
<span class="w">      </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx.conf.j2</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">    </span><span class="c1"># ... 50 more tasks ...</span>

<span class="c1">## Good - Organized into roles</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure web server</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">      </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">        </span><span class="nt">nginx_worker_processes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ssl_certificates</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">application</span>
</code></pre></div>
<h3 id="avoid-using-loop-with-package-module">❌ Avoid: Using Loop with Package Module<a class="headerlink" href="#avoid-using-loop-with-package-module" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - Inefficient loop</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install packages</span>
<span class="w">  </span><span class="nt">ansible.builtin.package</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">  </span><span class="nt">loop</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>

<span class="c1">## Good - Install all at once</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install packages</span>
<span class="w">  </span><span class="nt">ansible.builtin.package</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</code></pre></div>
<h3 id="avoid-no-proper-secret-management">❌ Avoid: No Proper Secret Management<a class="headerlink" href="#avoid-no-proper-secret-management" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - Secrets in plain text</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure database</span>
<span class="w">  </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database.yml.j2</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/app/database.yml</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">db_password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MySecretPassword123&quot;</span><span class="w">  </span><span class="c1"># ❌ Plain text!</span>

<span class="c1">## Good - Use Ansible Vault</span>
<span class="c1">## Encrypt with: ansible-vault encrypt vars/secrets.yml</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure database</span>
<span class="w">  </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database.yml.j2</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/app/database.yml</span>
<span class="w">  </span><span class="nt">vars_files</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vars/secrets.yml</span><span class="w">  </span><span class="c1"># ✅ Encrypted vault file</span>

<span class="c1">## Or use vault inline</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure database</span>
<span class="w">  </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database.yml.j2</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/app/database.yml</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">db_password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">vault_db_password</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w">  </span><span class="c1"># ✅ From vault</span>
</code></pre></div>
<hr />
<h2 id="security-best-practices">Security Best Practices<a class="headerlink" href="#security-best-practices" title="Permanent link">&para;</a></h2>
<h3 id="ansible-vault-for-secrets">Ansible Vault for Secrets<a class="headerlink" href="#ansible-vault-for-secrets" title="Permanent link">&para;</a></h3>
<p>Always encrypt sensitive data using Ansible Vault.</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - Plain text secrets in vars file</span>
<span class="c1">## vars/database.yml</span>
<span class="nt">db_host</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;prod-db.example.com&quot;</span>
<span class="nt">db_user</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;app_user&quot;</span>
<span class="nt">db_password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SuperSecret123&quot;</span><span class="w">  </span><span class="c1"># NEVER store plain text passwords!</span>
<span class="nt">api_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sk_live_abc123xyz&quot;</span><span class="w">   </span><span class="c1"># Exposed in version control!</span>

<span class="c1">## Good - Use Ansible Vault for secrets</span>
<span class="c1">## vars/vault.yml (encrypted with ansible-vault)</span>
<span class="nt">vault_db_password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SuperSecret123&quot;</span>
<span class="nt">vault_api_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sk_live_abc123xyz&quot;</span>

<span class="c1">## vars/database.yml (references vault variables)</span>
<span class="nt">db_host</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;prod-db.example.com&quot;</span>
<span class="nt">db_user</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;app_user&quot;</span>
<span class="nt">db_password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">vault_db_password</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="nt">api_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">vault_api_key</span><span class="nv"> </span><span class="s">}}&quot;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">## Encrypt entire file</span>
ansible-vault<span class="w"> </span>encrypt<span class="w"> </span>vars/vault.yml

<span class="c1">## Encrypt specific string</span>
ansible-vault<span class="w"> </span>encrypt_string<span class="w"> </span><span class="s1">&#39;SuperSecret123&#39;</span><span class="w"> </span>--name<span class="w"> </span><span class="s1">&#39;vault_db_password&#39;</span>

<span class="c1">## Run playbook with vault password</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--ask-vault-pass

<span class="c1">## Use password file (ensure file has restricted permissions)</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--vault-password-file<span class="w"> </span>~/.vault_pass
</code></pre></div>
<h3 id="privilege-escalation-security">Privilege Escalation Security<a class="headerlink" href="#privilege-escalation-security" title="Permanent link">&para;</a></h3>
<p>Use <code>become</code> safely and only when necessary.</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - Running everything as root</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy application</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span><span class="w">  </span><span class="c1"># Don&#39;t use become for entire play!</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy config file</span>
<span class="w">      </span><span class="nt">copy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config.yml</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/appuser/config.yml</span><span class="w">  </span><span class="c1"># Doesn&#39;t need root!</span>

<span class="c1">## Good - Use become only for tasks that require it</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy application</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install system package</span>
<span class="w">      </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span><span class="w">  </span><span class="c1"># Only escalate when needed</span>
<span class="w">      </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy config file</span>
<span class="w">      </span><span class="nt">copy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config.yml</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/appuser/config.yml</span>
<span class="w">        </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appuser</span>
<span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appuser</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0644&#39;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start service</span>
<span class="w">      </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">      </span><span class="nt">systemd</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
</code></pre></div>
<h3 id="safe-command-execution">Safe Command Execution<a class="headerlink" href="#safe-command-execution" title="Permanent link">&para;</a></h3>
<p>Prevent command injection when using shell/command modules.</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - Vulnerable to injection</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Process user input</span>
<span class="w">  </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;grep</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">user_search</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">/var/log/app.log&quot;</span><span class="w">  </span><span class="c1"># Injection risk!</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">user_search</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;USER_INPUT&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1">## Good - Use command module with arguments</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Process user input safely</span>
<span class="w">  </span><span class="nt">command</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cmd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grep</span>
<span class="w">    </span><span class="nt">argv</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">user_search</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">quote</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/app.log</span>

<span class="c1">## Good - Validate input with assertions</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Validate input</span>
<span class="w">  </span><span class="nt">assert</span><span class="p">:</span>
<span class="w">    </span><span class="nt">that</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user_search is regex(&#39;^[a-zA-Z0-9_-]+$&#39;)</span>
<span class="w">    </span><span class="nt">fail_msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Invalid</span><span class="nv"> </span><span class="s">search</span><span class="nv"> </span><span class="s">input</span><span class="nv"> </span><span class="s">format&quot;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Process validated input</span>
<span class="w">  </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;grep</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">user_search</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">quote</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">/var/log/app.log&quot;</span>
</code></pre></div>
<h3 id="ssh-key-management">SSH Key Management<a class="headerlink" href="#ssh-key-management" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - Disabling host key checking globally</span>
<span class="c1">## ansible.cfg</span>
<span class="p p-Indicator">[</span><span class="nv">defaults</span><span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">host_key_checking = False</span><span class="w">  </span><span class="c1"># SECURITY RISK!</span>

<span class="c1">## Good - Manage SSH known hosts properly</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Add SSH host key to known_hosts</span>
<span class="w">  </span><span class="nt">known_hosts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;pipe&#39;,</span><span class="nv"> </span><span class="s">&#39;ssh-keyscan</span><span class="nv"> </span><span class="s">-H</span><span class="nv"> </span><span class="s">&#39;</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">inventory_hostname)</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="c1">## Good - Use SSH key with passphrase</span>
<span class="c1">## ansible.cfg</span>
<span class="p p-Indicator">[</span><span class="nv">defaults</span><span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">private_key_file = ~/.ssh/ansible_deploy_key</span>
<span class="l l-Scalar l-Scalar-Plain">host_key_checking = True</span><span class="w">  </span><span class="c1"># Keep enabled!</span>

<span class="c1">## Ensure SSH key has proper permissions</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set SSH key permissions</span>
<span class="w">  </span><span class="nt">file</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">~/.ssh/ansible_deploy_key</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0600&#39;</span>
<span class="w">  </span><span class="nt">delegate_to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</code></pre></div>
<h3 id="secure-file-permissions">Secure File Permissions<a class="headerlink" href="#secure-file-permissions" title="Permanent link">&para;</a></h3>
<p>Always set appropriate file permissions.</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - World-readable sensitive files</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy database config</span>
<span class="w">  </span><span class="nt">copy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database.conf</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/app/database.conf</span><span class="w">  </span><span class="c1"># Default permissions too open!</span>

<span class="c1">## Good - Restrict sensitive file permissions</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy database config</span>
<span class="w">  </span><span class="nt">copy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database.conf</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/app/database.conf</span>
<span class="w">    </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appuser</span>
<span class="w">    </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appuser</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0600&#39;</span><span class="w">  </span><span class="c1"># Only owner can read/write</span>

<span class="c1">## Good - Secure directory permissions</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create config directory</span>
<span class="w">  </span><span class="nt">file</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/app/secrets</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
<span class="w">    </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appuser</span>
<span class="w">    </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appuser</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0750&#39;</span><span class="w">  </span><span class="c1"># Owner: rwx, Group: rx, Other: none</span>
</code></pre></div>
<h3 id="inventory-security">Inventory Security<a class="headerlink" href="#inventory-security" title="Permanent link">&para;</a></h3>
<p>Protect inventory files and limit exposure.</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - Sensitive data in inventory</span>
<span class="c1">## inventory/production.ini</span>
<span class="p p-Indicator">[</span><span class="nv">webservers</span><span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">web1.example.com ansible_ssh_pass=MyPassword123</span><span class="w">  </span><span class="c1"># NEVER!</span>
<span class="l l-Scalar l-Scalar-Plain">web2.example.com ansible_become_pass=RootPass456</span><span class="w">  </span><span class="c1"># EXPOSED!</span>

<span class="c1">## Good - Use vault for inventory variables</span>
<span class="c1">## inventory/production.yml</span>
<span class="nt">all</span><span class="p">:</span>
<span class="w">  </span><span class="nt">children</span><span class="p">:</span>
<span class="w">    </span><span class="nt">webservers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">        </span><span class="nt">web1.example.com</span><span class="p">:</span>
<span class="w">        </span><span class="nt">web2.example.com</span><span class="p">:</span>
<span class="w">      </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">        </span><span class="nt">ansible_ssh_pass</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">vault_ssh_password</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">ansible_become_pass</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">vault_become_password</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1">## Better - Use SSH keys instead of passwords</span>
<span class="p p-Indicator">[</span><span class="nv">webservers</span><span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">web1.example.com ansible_ssh_private_key_file=~/.ssh/deploy_key</span>
<span class="l l-Scalar l-Scalar-Plain">web2.example.com ansible_ssh_private_key_file=~/.ssh/deploy_key</span>
</code></pre></div>
<h3 id="secure-downloads-and-package-installation">Secure Downloads and Package Installation<a class="headerlink" href="#secure-downloads-and-package-installation" title="Permanent link">&para;</a></h3>
<p>Verify checksums and signatures when downloading files.</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - Download without verification</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Download binary</span>
<span class="w">  </span><span class="nt">get_url</span><span class="p">:</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://example.com/app.tar.gz</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/app.tar.gz</span><span class="w">  </span><span class="c1"># No verification!</span>

<span class="c1">## Good - Verify checksum</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Download and verify binary</span>
<span class="w">  </span><span class="nt">get_url</span><span class="p">:</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://releases.example.com/app-v1.2.3.tar.gz</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/app.tar.gz</span>
<span class="w">    </span><span class="nt">checksum</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sha256:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855&quot;</span>

<span class="c1">## Good - Use official package repositories</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install from trusted repository</span>
<span class="w">  </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="nt">update_cache</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</code></pre></div>
<h3 id="audit-logging">Audit Logging<a class="headerlink" href="#audit-logging" title="Permanent link">&para;</a></h3>
<p>Enable logging for security auditing.</p>
<div class="highlight"><pre><span></span><code><span class="c1">## ansible.cfg</span>
<span class="p p-Indicator">[</span><span class="nv">defaults</span><span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">log_path = /var/log/ansible/ansible.log</span>
<span class="l l-Scalar l-Scalar-Plain">callback_whitelist = profile_tasks, timer</span>

<span class="l l-Scalar l-Scalar-Plain">## Playbook example with logging</span>
<span class="l l-Scalar l-Scalar-Plain">- name</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Security-sensitive operations</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Log security action</span>
<span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
<span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;User</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_user</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">performed</span><span class="nv"> </span><span class="s">security</span><span class="nv"> </span><span class="s">action</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_date_time.iso8601</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Perform sensitive operation</span>
<span class="w">      </span><span class="c1"># ...</span>
<span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">result</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Log operation result</span>
<span class="w">      </span><span class="nt">lineinfile</span><span class="p">:</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/app_security.log</span>
<span class="w">        </span><span class="nt">line</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_date_time.iso8601</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_user</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">result.changed</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">create</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0640&#39;</span>
</code></pre></div>
<h3 id="no-log-for-sensitive-output">No Log for Sensitive Output<a class="headerlink" href="#no-log-for-sensitive-output" title="Permanent link">&para;</a></h3>
<p>Prevent sensitive data from appearing in logs.</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Bad - Passwords logged in output</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set database password</span>
<span class="w">  </span><span class="nt">mysql_user</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appuser</span>
<span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">db_password</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">  </span><span class="c1"># Password will appear in Ansible logs!</span>

<span class="c1">## Good - Suppress logging of sensitive tasks</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set database password</span>
<span class="w">  </span><span class="nt">mysql_user</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appuser</span>
<span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">db_password</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">  </span><span class="nt">no_log</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Prevents password from appearing in output</span>

<span class="c1">## Good - Selectively show safe data</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy application</span>
<span class="w">  </span><span class="nt">copy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app.jar</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/app/app.jar</span>
<span class="w">  </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy_result</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Show deployment status (safe)</span>
<span class="w">  </span><span class="nt">debug</span><span class="p">:</span>
<span class="w">    </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Deployment</span><span class="nv"> </span><span class="s">changed:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">deploy_result.changed</span><span class="nv"> </span><span class="s">}}&quot;</span>
</code></pre></div>
<hr />
<h2 id="tool-configuration">Tool Configuration<a class="headerlink" href="#tool-configuration" title="Permanent link">&para;</a></h2>
<h3 id="ansiblecfg">ansible.cfg<a class="headerlink" href="#ansiblecfg" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">[defaults]</span>
<span class="na">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">inventory/production.yml</span>
<span class="na">remote_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">deploy</span>
<span class="na">host_key_checking</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">False</span>
<span class="na">retry_files_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">False</span>
<span class="na">gathering</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">smart</span>
<span class="na">fact_caching</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">jsonfile</span>
<span class="na">fact_caching_connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/tmp/ansible_facts</span>
<span class="na">fact_caching_timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">3600</span>
<span class="na">forks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">20</span>
<span class="na">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">30</span>

<span class="k">[privilege_escalation]</span>
<span class="na">become</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<span class="na">become_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">sudo</span>
<span class="na">become_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">root</span>
<span class="na">become_ask_pass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">False</span>

<span class="k">[ssh_connection]</span>
<span class="na">pipelining</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<span class="na">control_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/tmp/ansible-ssh-%%h-%%p-%%r</span>
</code></pre></div>
<h3 id="ansible-lint-configuration">ansible-lint Configuration<a class="headerlink" href="#ansible-lint-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">## .ansible-lint</span>
<span class="nn">---</span>
<span class="nt">skip_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yaml[line-length]</span><span class="w">  </span><span class="c1"># Ignore long lines</span>

<span class="nt">use_default_rules</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">enable_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no-log-password</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no-same-owner</span>

<span class="nt">kinds</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">yaml</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;*.yaml&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">yaml</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;*.yml&quot;</span>
</code></pre></div>
<hr />
<h2 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h2>
<h3 id="always-use-fully-qualified-collection-names-fqcn">Always Use Fully Qualified Collection Names (FQCN)<a class="headerlink" href="#always-use-fully-qualified-collection-names-fqcn" title="Permanent link">&para;</a></h3>
<p>Use explicit collection names to avoid ambiguity and future-proof playbooks:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Good - Fully qualified collection name</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install nginx</span>
<span class="w">  </span><span class="nt">ansible.builtin.package</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy configuration</span>
<span class="w">  </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config.yml</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/app/config.yml</span>

<span class="c1"># Bad - Short module name (deprecated)</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install nginx</span>
<span class="w">  </span><span class="nt">package</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</code></pre></div>
<h3 id="always-name-tasks">Always Name Tasks<a class="headerlink" href="#always-name-tasks" title="Permanent link">&para;</a></h3>
<p>Provide descriptive names for every task:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Good - Clear, descriptive task names</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install PostgreSQL database server</span>
<span class="w">  </span><span class="nt">ansible.builtin.package</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql-server</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create application database and user</span>
<span class="w">  </span><span class="nt">community.postgresql.postgresql_db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appdb</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="c1"># Bad - No task names</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ansible.builtin.package</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql-server</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</code></pre></div>
<h3 id="ensure-idempotency">Ensure Idempotency<a class="headerlink" href="#ensure-idempotency" title="Permanent link">&para;</a></h3>
<p>Write tasks that can be run multiple times without causing issues:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Good - Idempotent operations</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure nginx is installed</span>
<span class="w">  </span><span class="nt">ansible.builtin.package</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span><span class="w">  </span><span class="c1"># Idempotent: installs only if missing</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure directory exists</span>
<span class="w">  </span><span class="nt">ansible.builtin.file</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/app</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0755&#39;</span>

<span class="c1"># Bad - Not idempotent</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Download file</span>
<span class="w">  </span><span class="nt">ansible.builtin.command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wget https://example.com/file.tar.gz -O /tmp/file.tar.gz</span>
<span class="w">  </span><span class="c1"># This re-downloads every time, even if file exists</span>

<span class="c1"># Good - Idempotent download</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Download file</span>
<span class="w">  </span><span class="nt">ansible.builtin.get_url</span><span class="p">:</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://example.com/file.tar.gz</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/file.tar.gz</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0644&#39;</span>
<span class="w">    </span><span class="nt">checksum</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sha256:abc123...</span>
</code></pre></div>
<h3 id="use-variables-instead-of-hardcoding">Use Variables Instead of Hardcoding<a class="headerlink" href="#use-variables-instead-of-hardcoding" title="Permanent link">&para;</a></h3>
<p>Parameterize playbooks with variables:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Good - Variables for flexibility</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy application</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class="w">    </span><span class="nt">app_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">    </span><span class="nt">app_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appuser</span>
<span class="w">    </span><span class="nt">app_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/{{ app_name }}</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create application directory</span>
<span class="w">      </span><span class="nt">ansible.builtin.file</span><span class="p">:</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">app_dir</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
<span class="w">        </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">app_user</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0755&#39;</span>

<span class="c1"># Bad - Hardcoded values</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create application directory</span>
<span class="w">  </span><span class="nt">ansible.builtin.file</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/myapp</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
<span class="w">    </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appuser</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0755&#39;</span>
</code></pre></div>
<h3 id="organize-with-roles">Organize with Roles<a class="headerlink" href="#organize-with-roles" title="Permanent link">&para;</a></h3>
<p>Structure complex playbooks using roles:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Good - Organized with roles</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure web infrastructure</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">common</span>
<span class="w">      </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">        </span><span class="nt">common_packages</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vim</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">curl</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">      </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">        </span><span class="nt">nginx_worker_processes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ssl_certificates</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">application</span>

<span class="c1"># Bad - Everything in one playbook</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure web infrastructure</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install common packages</span>
<span class="w">      </span><span class="nt">ansible.builtin.package</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">      </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">vim</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">curl</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">git</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="c1"># ... 100 more tasks ...</span>
</code></pre></div>
<h3 id="use-tags-for-flexibility">Use Tags for Flexibility<a class="headerlink" href="#use-tags-for-flexibility" title="Permanent link">&para;</a></h3>
<p>Tag tasks for selective execution:</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Complete application deployment</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appservers</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">      </span><span class="nt">ansible.builtin.package</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">      </span><span class="nt">loop</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python3</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python3-pip</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">packages</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">setup</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy application code</span>
<span class="w">      </span><span class="nt">ansible.builtin.git</span><span class="p">:</span>
<span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">app_repo</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/app</span>
<span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">app_version</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run database migrations</span>
<span class="w">      </span><span class="nt">ansible.builtin.command</span><span class="p">:</span>
<span class="w">        </span><span class="nt">cmd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python3 manage.py migrate</span>
<span class="w">        </span><span class="nt">chdir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/app</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database</span>

<span class="c1"># Run only deployment tasks</span>
<span class="c1"># ansible-playbook site.yml --tags &quot;deploy&quot;</span>

<span class="c1"># Skip database migrations</span>
<span class="c1"># ansible-playbook site.yml --skip-tags &quot;database&quot;</span>
</code></pre></div>
<h3 id="implement-proper-error-handling">Implement Proper Error Handling<a class="headerlink" href="#implement-proper-error-handling" title="Permanent link">&para;</a></h3>
<p>Use blocks with rescue for robust error handling:</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy with automatic rollback</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appservers</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment with rollback</span>
<span class="w">      </span><span class="nt">block</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Stop application</span>
<span class="w">          </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class="w">            </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stopped</span>

<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy new version</span>
<span class="w">          </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
<span class="w">            </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-v2.jar</span>
<span class="w">            </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/app/app.jar</span>
<span class="w">            </span><span class="nt">backup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">          </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy_result</span>

<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start application</span>
<span class="w">          </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class="w">            </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>

<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Wait for health check</span>
<span class="w">          </span><span class="nt">ansible.builtin.uri</span><span class="p">:</span>
<span class="w">            </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8080/health</span>
<span class="w">            </span><span class="nt">status_code</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200</span>
<span class="w">          </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">          </span><span class="nt">delay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>

<span class="w">      </span><span class="nt">rescue</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Rollback on failure</span>
<span class="w">          </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
<span class="w">            </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">deploy_result.backup_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">            </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/app/app.jar</span>
<span class="w">            </span><span class="nt">remote_src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">          </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy_result.backup_file is defined</span>

<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart with previous version</span>
<span class="w">          </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class="w">            </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>

<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Send failure notification</span>
<span class="w">          </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
<span class="w">            </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Deployment</span><span class="nv"> </span><span class="s">failed,</span><span class="nv"> </span><span class="s">rolled</span><span class="nv"> </span><span class="s">back</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">previous</span><span class="nv"> </span><span class="s">version&quot;</span>

<span class="w">      </span><span class="nt">always</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Clean up temporary files</span>
<span class="w">          </span><span class="nt">ansible.builtin.file</span><span class="p">:</span>
<span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/deploy</span>
<span class="w">            </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>
</code></pre></div>
<h3 id="use-ansible-vault-for-secrets">Use Ansible Vault for Secrets<a class="headerlink" href="#use-ansible-vault-for-secrets" title="Permanent link">&para;</a></h3>
<p>Never store secrets in plain text:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Good - Use vault for secrets</span>
<span class="nn">---</span>
<span class="c1"># vars/vault.yml (encrypted)</span>
<span class="nt">vault_db_password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SuperSecret123&quot;</span>
<span class="nt">vault_api_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sk_live_abc123&quot;</span>

<span class="c1"># playbook.yml</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure application</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appservers</span>
<span class="w">  </span><span class="nt">vars_files</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vars/vault.yml</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy configuration</span>
<span class="w">      </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config.yml.j2</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/app/config.yml</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0600&#39;</span>
<span class="w">      </span><span class="nt">no_log</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Prevent secrets in output</span>

<span class="c1"># Run with: ansible-playbook playbook.yml --ask-vault-pass</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Encrypt secrets file</span>
ansible-vault<span class="w"> </span>encrypt<span class="w"> </span>vars/vault.yml

<span class="c1"># Encrypt inline string</span>
ansible-vault<span class="w"> </span>encrypt_string<span class="w"> </span><span class="s1">&#39;SuperSecret123&#39;</span><span class="w"> </span>--name<span class="w"> </span><span class="s1">&#39;vault_db_password&#39;</span>
</code></pre></div>
<h3 id="disable-fact-gathering-when-not-needed">Disable Fact Gathering When Not Needed<a class="headerlink" href="#disable-fact-gathering-when-not-needed" title="Permanent link">&para;</a></h3>
<p>Improve performance by skipping unnecessary fact gathering:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Good - Disable when facts not needed</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Simple file deployment</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># Saves 2-5 seconds per host</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy application files</span>
<span class="w">      </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app.jar</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/app/</span>

<span class="c1"># Good - Gather only required facts</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OS-specific configuration</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">gather_subset</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;!all&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;!min&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtual</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure based on OS</span>
<span class="w">      </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;config_{{</span><span class="nv"> </span><span class="s">ansible_os_family</span><span class="nv"> </span><span class="s">}}.j2&quot;</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/app/config.yml</span>
</code></pre></div>
<h3 id="use-check-mode-for-dry-runs">Use Check Mode for Dry Runs<a class="headerlink" href="#use-check-mode-for-dry-runs" title="Permanent link">&para;</a></h3>
<p>Test playbooks before execution:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Run in check mode (dry run)</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--check

<span class="c1"># Show differences that would be made</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--check<span class="w"> </span>--diff

<span class="c1"># Limit to specific hosts</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--check<span class="w"> </span>--limit<span class="w"> </span>webservers
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Mark tasks that support check mode</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create directory</span>
<span class="w">  </span><span class="nt">ansible.builtin.file</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/app</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
<span class="w">  </span><span class="nt">check_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span><span class="w">  </span><span class="c1"># Always runs in check mode</span>

<span class="c1"># Mark tasks that should run even in check mode</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gather current state</span>
<span class="w">  </span><span class="nt">ansible.builtin.command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /etc/app/version</span>
<span class="w">  </span><span class="nt">check_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span><span class="w">  </span><span class="c1"># Runs even when --check is used</span>
<span class="w">  </span><span class="nt">changed_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>
<h3 id="version-pin-collections">Version Pin Collections<a class="headerlink" href="#version-pin-collections" title="Permanent link">&para;</a></h3>
<p>Specify collection versions in requirements.yml:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># collections/requirements.yml</span>
<span class="nn">---</span>
<span class="nt">collections</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">community.general</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&gt;=5.0.0,&lt;6.0.0&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible.posix</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.5.4&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">community.docker</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.4.8&quot;</span>

<span class="c1"># Install collections</span>
<span class="c1"># ansible-galaxy collection install -r collections/requirements.yml</span>
</code></pre></div>
<h3 id="document-playbooks-and-roles">Document Playbooks and Roles<a class="headerlink" href="#document-playbooks-and-roles" title="Permanent link">&para;</a></h3>
<p>Add clear documentation to playbooks and roles:</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="c1"># playbooks/deploy-app.yml</span>

<span class="c1">## @module application_deployment</span>
<span class="c1">## @description Deploy application to production servers</span>
<span class="c1">## @dependencies ansible.builtin, community.general</span>
<span class="c1">## @version 2.1.0</span>
<span class="c1">## @author DevOps Team</span>
<span class="c1">## @tags deployment, production, application</span>
<span class="c1">##</span>
<span class="c1">## Variables:</span>
<span class="c1">##   app_version: Application version to deploy (required)</span>
<span class="c1">##   app_environment: Target environment (dev/staging/prod)</span>
<span class="c1">##   skip_migrations: Skip database migrations (default: false)</span>
<span class="c1">##</span>
<span class="c1">## Usage:</span>
<span class="c1">##   ansible-playbook playbooks/deploy-app.yml -e &quot;app_version=1.2.3&quot;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy application to production</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appservers</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app_environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="w">    </span><span class="nt">skip_migrations</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># ... tasks ...</span>
</code></pre></div>
<h3 id="use-handlers-correctly">Use Handlers Correctly<a class="headerlink" href="#use-handlers-correctly" title="Permanent link">&para;</a></h3>
<p>Trigger handlers efficiently and flush when needed:</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure nginx</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Update nginx main configuration</span>
<span class="w">      </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx.conf.j2</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">      </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Update virtual host configuration</span>
<span class="w">      </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vhost.conf.j2</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/sites-enabled/{{ item }}</span>
<span class="w">      </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nginx_vhosts</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>

<span class="w">    </span><span class="c1"># Handler runs once even though notified twice</span>

<span class="w">  </span><span class="nt">handlers</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>
<span class="w">      </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reloaded</span>

<span class="c1"># Force handler execution before testing</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test configuration</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Update nginx config</span>
<span class="w">      </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx.conf.j2</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">      </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Force handler execution</span>
<span class="w">      </span><span class="nt">ansible.builtin.meta</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flush_handlers</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test nginx is responding</span>
<span class="w">      </span><span class="nt">ansible.builtin.uri</span><span class="p">:</span>
<span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost/health</span>
<span class="w">        </span><span class="nt">status_code</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200</span>
</code></pre></div>
<h3 id="validate-templates">Validate Templates<a class="headerlink" href="#validate-templates" title="Permanent link">&para;</a></h3>
<p>Use the validate parameter to test configurations before deployment:</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy nginx configuration</span>
<span class="w">  </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx.conf.j2</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">    </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;nginx</span><span class="nv"> </span><span class="s">-t</span><span class="nv"> </span><span class="s">-c</span><span class="nv"> </span><span class="s">%s&#39;</span>
<span class="w">    </span><span class="nt">backup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy SSH daemon config</span>
<span class="w">  </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sshd_config.j2</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssh/sshd_config</span>
<span class="w">    </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/usr/sbin/sshd</span><span class="nv"> </span><span class="s">-t</span><span class="nv"> </span><span class="s">-f</span><span class="nv"> </span><span class="s">%s&#39;</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0600&#39;</span>
<span class="w">  </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart sshd</span>
</code></pre></div>
<h3 id="use-assertions-for-prerequisites">Use Assertions for Prerequisites<a class="headerlink" href="#use-assertions-for-prerequisites" title="Permanent link">&para;</a></h3>
<p>Validate requirements before executing playbooks:</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy application</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appservers</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Verify required variables are defined</span>
<span class="w">      </span><span class="nt">ansible.builtin.assert</span><span class="p">:</span>
<span class="w">        </span><span class="nt">that</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app_version is defined</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app_version is match(&#39;^\d+\.\d+\.\d+$&#39;)</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app_environment in [&#39;dev&#39;, &#39;staging&#39;, &#39;prod&#39;]</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_host is defined</span>
<span class="w">        </span><span class="nt">fail_msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Required</span><span class="nv"> </span><span class="s">variables</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">missing</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">invalid&quot;</span>
<span class="w">        </span><span class="nt">success_msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;All</span><span class="nv"> </span><span class="s">prerequisites</span><span class="nv"> </span><span class="s">validated&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check disk space before deployment</span>
<span class="w">      </span><span class="nt">ansible.builtin.assert</span><span class="p">:</span>
<span class="w">        </span><span class="nt">that</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_mounts | selectattr(&#39;mount&#39;, &#39;equalto&#39;, &#39;/opt&#39;) | map(attribute=&#39;size_available&#39;) | first &gt; 5000000000</span>
<span class="w">        </span><span class="nt">fail_msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Insufficient</span><span class="nv"> </span><span class="s">disk</span><span class="nv"> </span><span class="s">space</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">/opt</span><span class="nv"> </span><span class="s">(need</span><span class="nv"> </span><span class="s">5GB)&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Proceed with deployment</span>
<span class="w">      </span><span class="c1"># ... deployment tasks ...</span>
</code></pre></div>
<h3 id="use-delegation-appropriately">Use Delegation Appropriately<a class="headerlink" href="#use-delegation-appropriately" title="Permanent link">&para;</a></h3>
<p>Run tasks on different hosts when needed:</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Database operations</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appservers</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run database migration (on db server)</span>
<span class="w">      </span><span class="nt">ansible.builtin.command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/scripts/migrate.sh</span>
<span class="w">      </span><span class="nt">delegate_to</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">groups[&#39;dbservers&#39;][0]</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">run_once</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Run only once, not for each appserver</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Add host to monitoring (on monitoring server)</span>
<span class="w">      </span><span class="nt">community.general.datadog_monitor</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">      </span><span class="nt">delegate_to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring.example.com</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Update load balancer (locally)</span>
<span class="w">      </span><span class="nt">ansible.builtin.uri</span><span class="p">:</span>
<span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://lb.example.com/api/update&quot;</span>
<span class="w">        </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POST</span>
<span class="w">        </span><span class="nt">body_format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json</span>
<span class="w">        </span><span class="nt">body</span><span class="p">:</span>
<span class="w">          </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">delegate_to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</code></pre></div>
<h3 id="optimize-with-async-and-polling">Optimize with Async and Polling<a class="headerlink" href="#optimize-with-async-and-polling" title="Permanent link">&para;</a></h3>
<p>Run long tasks asynchronously:</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Long-running tasks</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appservers</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start long backup process</span>
<span class="w">      </span><span class="nt">ansible.builtin.command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/local/bin/backup.sh</span>
<span class="w">      </span><span class="nt">async</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3600</span><span class="w">  </span><span class="c1"># Allow up to 1 hour</span>
<span class="w">      </span><span class="nt">poll</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w">  </span><span class="c1"># Fire and forget</span>
<span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backup_job</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Continue with other tasks</span>
<span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
<span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Backup</span><span class="nv"> </span><span class="s">running</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">background&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check backup job status</span>
<span class="w">      </span><span class="nt">ansible.builtin.async_status</span><span class="p">:</span>
<span class="w">        </span><span class="nt">jid</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">backup_job.ansible_job_id</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backup_result</span>
<span class="w">      </span><span class="nt">until</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backup_result.finished</span>
<span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
<span class="w">      </span><span class="nt">delay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span><span class="w">  </span><span class="c1"># Check every minute</span>

<span class="c1"># Run tasks in parallel across hosts</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install packages in parallel</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">free</span><span class="w">  </span><span class="c1"># Don&#39;t wait for all hosts to finish each task</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install updates</span>
<span class="w">      </span><span class="nt">ansible.builtin.package</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;*&quot;</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
</code></pre></div>
<h3 id="use-includes-and-imports-strategically">Use Includes and Imports Strategically<a class="headerlink" href="#use-includes-and-imports-strategically" title="Permanent link">&para;</a></h3>
<p>Break up large playbooks:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># main.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Full infrastructure deployment</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Include pre-deployment checks</span>
<span class="w">      </span><span class="nt">ansible.builtin.include_tasks</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tasks/pre_checks.yml</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Import common configuration (static)</span>
<span class="w">      </span><span class="nt">ansible.builtin.import_tasks</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tasks/common_setup.yml</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Include environment-specific tasks (dynamic)</span>
<span class="w">      </span><span class="nt">ansible.builtin.include_tasks</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tasks/{{</span><span class="nv"> </span><span class="s">app_environment</span><span class="nv"> </span><span class="s">}}_setup.yml&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Import roles based on host group</span>
<span class="w">      </span><span class="nt">ansible.builtin.include_role</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">group_names</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">item in [&#39;webserver&#39;, &#39;database&#39;, &#39;cache&#39;]</span>
</code></pre></div>
<hr />
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<h3 id="official-documentation">Official Documentation<a class="headerlink" href="#official-documentation" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://docs.ansible.com/">Ansible Documentation</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/collections_guide/index.html">Ansible Collections</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/tips_tricks/ansible_tips_tricks.html">Ansible Best Practices</a></li>
</ul>
<h3 id="tools">Tools<a class="headerlink" href="#tools" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://ansible-lint.readthedocs.io/">ansible-lint</a> - Linter for Ansible playbooks</li>
<li><a href="https://molecule.readthedocs.io/">Molecule</a> - Testing framework for Ansible roles</li>
<li><a href="https://galaxy.ansible.com/">Ansible Galaxy</a> - Repository for collections and roles</li>
</ul>
<h3 id="community-resources">Community Resources<a class="headerlink" href="#community-resources" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://docs.ansible.com/ansible/latest/community/index.html">Ansible Community Guide</a></li>
<li><a href="https://github.com/ansible-collections">Ansible Collections on GitHub</a></li>
</ul>
<hr />
<p><strong>Status</strong>: Active</p>







  
  



  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/tydukes" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://linkedin.com/in/tydukes" target="_blank" rel="noopener" title="linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.top", "toc.follow", "content.code.annotate", "content.code.copy", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"alias": true, "default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../javascripts/shortcuts.js"></script>
      
        <script src="../../javascripts/related-pages.js"></script>
      
        <script src="../../javascripts/bookmarks.js"></script>
      
    
  </body>
</html>